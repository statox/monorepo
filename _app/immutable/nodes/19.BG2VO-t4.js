import"../chunks/DsnmJJEf.js";import{p as fe,h as C,F as S,b as E,s as u,e as p,i as c,g as e,r as h,t as z,a as P,n as q,d as ge,f as W,a$ as Re,aI as ve,j as me,c as He}from"../chunks/eXUqL77E.js";import{d as be,s as _e,e as Ie}from"../chunks/BemXrffE.js";import{i as N}from"../chunks/CTMdkGpN.js";import{s as D,r as de}from"../chunks/CujdopWx.js";import{M as Ne}from"../chunks/utk3oDie.js";import{m as H,g as F,c as R,b as O,B as g,d as Y,a as qe,n as De,e as Ee,i as Fe,f as Le}from"../chunks/DukMpd72.js";import{e as Ue,i as Ve}from"../chunks/D9zXBg3D.js";import{b as pe}from"../chunks/CEUJmi10.js";import"../chunks/ctDXYmCv.js";import"../chunks/CguJ9Ee1.js";import{p as Ge}from"../chunks/B4-ntoLf.js";/* empty css                */import"../chunks/B0neLVfT.js";import{g as $e}from"../chunks/BJmgLU8A.js";const je=a=>{const o=F(a),t=Math.floor(Math.random()*o.length);return o[t]},Ae=(a,o)=>{const t=je(a);return{board:H(a,o,t),move:t}},Ke=(a,o,t)=>{const n=Xe(a,o,t.iterations,t.c);return{board:H(a,o,n),move:n}};class ye{board;player;move;parent;children=[];visits=0;wins=0;constructor(o,t,n=null,r=null){this.board=o,this.player=t,this.move=n,this.parent=r}isFullyExpanded(){return this.children.length===F(this.board).length}isTerminal(){return O(this.board)!==g.notOver}}function he(a,o,t,n=Math.sqrt(2)){return t===0?1/0:o/t+n*Math.sqrt(Math.log(a)/t)}function We(a,o){for(;!a.isTerminal();)if(a.isFullyExpanded())a=ze(a,o);else return Ye(a);return a}function Ye(a){const o=a.children.map(i=>i.move),n=F(a.board).filter(i=>!o.includes(i)),r=n[Math.floor(Math.random()*n.length)],s=R(a.board);H(s,a.player,r);const m=new ye(s,a.player===1?2:1,r,a);return a.children.push(m),m}function ze(a,o){return a.children.reduce((t,n)=>{const r=he(a.visits,t.wins,t.visits,o);return he(a.visits,n.wins,n.visits,o)>r?n:t})}function Je(a){const o=R(a.board);let t=a.player;for(;;){const n=O(o);if(n!==g.notOver)return n;const r=F(o),s=r[Math.floor(Math.random()*r.length)];H(o,t,s),t=t===1?2:1}}function Qe(a,o){let t=a;for(;t!==null;)t.visits+=1,o===g.winPlayer1&&t.parent?.player===1||o===g.winPlayer2&&t.parent?.player===2?t.wins+=1:o===g.draw&&(t.wins+=.5),t=t.parent}function Xe(a,o,t=1e3,n=Math.sqrt(2)){const r=new ye(R(a),o,null,null);for(let m=0;m<t;m++){const i=We(r,n),y=Je(i);Qe(i,y)}return r.children.reduce((m,i)=>m.visits>i.visits?m:i).move}var Ze=E("<button> </button>"),et=E(`<div><h4>Monte Carlo Tree Search parameters</h4> <div class="difficulty-options svelte-90tef"><label for="mcts-preset">Preset difficulty</label> <!></div> <div><h5>Iterations:</h5> <input id="mcts-iterations" type="number" min="0"/></div> <div>Number of simulations MCTS will run before choosing a move. Higher values usually mean
        stronger play but slower decisions.</div> <div><h5>C (exploration constant):</h5> <input id="mcts-c" type="number" min="0" step="0.1"/></div> <div>Controls the balance between exploration and exploitation. Lower values (e.g. 0.5, 0.7)
        favor tested moves, higher values (e.g. 2.0, 5.0) explore more. A typical default is √2 ≈
        1.41.</div></div>`);function tt(a,o){fe(o,!0);const t=[{name:"easy",iterations:200,c:2},{name:"medium",iterations:1e3,c:1.41},{name:"hard",iterations:5e3,c:.7}],n=t[1];let r=C(S(n.iterations)),s=C(S(n.c));const m=()=>{o.onUpdate({iterations:e(r),c:e(s)})};var i=et(),y=u(p(i),2),d=u(p(y),2);Ue(d,17,()=>t,Ve,(w,_)=>{var M=Ze();M.__click=()=>{c(r,e(_).iterations,!0),c(s,e(_).c,!0),m()};let k;var L=p(M,!0);h(M),z(()=>{k=D(M,1,"",null,k,{selected:e(s)===e(_).c&&e(r)===e(_).iterations}),_e(L,e(_).name)}),P(w,M)}),h(y);var b=u(y,2),v=u(p(b),2);de(v),v.__change=m,h(b);var T=u(b,4),x=u(p(T),2);de(x),x.__change=m,h(T),q(2),h(i),pe(v,()=>e(r),w=>c(r,w)),pe(x,()=>e(s),w=>c(s,w)),P(a,i),ge()}be(["click","change"]);var at=E("Game Over - <!>",1),rt=E('<!> <h3>Local game <button>Back</button></h3> <div class="opponent-choice svelte-1m0eka9"><label for="opponent-options">Choose your opponent:</label> <div class="opponent-options svelte-1m0eka9"><div><button>Human</button> Play with another human on the same computer.</div> <div><button>Random</button> The computer makes completely random moves, no intelligence at all.</div> <div><button>MCTS</button> The computer uses a <a href="https://en.wikipedia.org/wiki/Monte_Carlo_tree_search">Monte Carlo tree search</a> algorithm to make smart moves. You can tweak the difficulty at the bottom of the page.</div></div></div> <div class="game-controls svelte-1m0eka9"><button>New game</button> <button>Cancel move</button></div> <div class="game-results svelte-1m0eka9"><!></div> <!> <div class="computer-settings svelte-1m0eka9"><!></div>',1);function _t(a,o){fe(o,!0);const t={name:"Gravitrips",description:"4 in a row",iconPath:"/gravitrips.png"};Ge.set(t);let n=C(S(Y())),r=C(S([])),s=ve(()=>O(e(n))),m=ve(()=>Le(e(n))),i=C("mcts"),y=C(S({iterations:1e3,c:1.41})),d=C(1),b=1,v=2;const T=()=>{c(n,Y(),!0),c(r,[],!0),c(d,1),[b,v]=[v,b],e(i)!=="manual"&&v===e(d)&&k()},x=(l,f)=>{e(r).push({board:R(l),moveByPlayer:f}),c(r,e(r),!0)},w=()=>{if(e(i)==="manual")e(r).pop(),_();else{if(e(r).length===1&&e(r)[e(r).length-1].moveByPlayer===v)return;e(r)[e(r).length-1].moveByPlayer===v&&e(r).pop(),e(r).length&&e(r)[e(r).length-1].moveByPlayer===b&&e(r).pop()}c(r,e(r),!0),e(r).length===0?c(n,Y(),!0):c(n,R(e(r)[e(r).length-1].board),!0)},_=()=>c(d,e(d)===1?2:1,!0),M=l=>{if(b!==e(d)&&e(i)!=="manual"||!Fe(e(n),l)||O(e(n))!==g.notOver)return;let f;if(b===e(d))f=b;else if(v===e(d)&&e(i)==="manual")f=v;else return;c(n,H(e(n),f,l),!0),x(e(n),f),_(),e(i)!=="manual"&&setTimeout(()=>k(),200)},k=()=>{if(v!==e(d)||O(e(n))!==g.notOver||e(i)==="manual")return;let l;if(e(i)==="random")l=Ae(e(n),e(d));else if(e(i)==="mcts")l=Ke(e(n),e(d),e(y));else throw new Error("computer strategy not implemented");const{board:f}=l;c(n,f,!0),x(e(n),v),_()},L=l=>{switch(l.key){case"r":T();break}};var J=rt();Ie("keydown",Re,L);var Q=W(J);Ne(Q,{get title(){return t.name},get description(){return t.description},get iconPath(){return t.iconPath}});var U=u(Q,2),we=u(p(U));we.__click=()=>$e("/gravitrips"),h(U);var V=u(U,2),X=u(p(V),2),G=p(X),Z=p(G);Z.__click=()=>{c(i,"manual")};let ee;q(),h(G);var $=u(G,2),te=p($);te.__click=()=>{c(i,"random"),v===e(d)&&k()};let ae;q(),h($);var re=u($,2),ne=p(re);ne.__click=()=>{c(i,"mcts"),v===e(d)&&k()};let oe;q(3),h(re),h(X),h(V);var j=u(V,2),ie=p(j);ie.__click=T;var se=u(ie,2);se.__click=w,h(j);var A=u(j,2),Me=p(A);{var ke=l=>{var f=at(),xe=u(W(f));{var Be=B=>{var I=me("Draw");P(B,I)},Te=B=>{var I=He(),Se=W(I);{var Oe=K=>{var ue=me();z(()=>_e(ue,`Player ${e(s)??""} wins`)),P(K,ue)};N(Se,K=>{(e(s)===g.winPlayer1||e(s)===g.winPlayer2)&&K(Oe)},!0)}P(B,I)};N(xe,B=>{e(s)===g.draw?B(Be):B(Te,!1)})}P(l,f)};N(Me,l=>{e(s)!==g.notOver&&l(ke)})}h(A);var le=u(A,2);qe(le,{get nbColumns(){return Ee},get nbRows(){return De},get board(){return e(n)},get winningCells(){return e(m)},onMove:M});var ce=u(le,2),Ce=p(ce);{var Pe=l=>{tt(l,{onUpdate:f=>c(y,f,!0)})};N(Ce,l=>{e(i)==="mcts"&&l(Pe)})}h(ce),z(()=>{ee=D(Z,1,"",null,ee,{selected:e(i)==="manual"}),ae=D(te,1,"",null,ae,{selected:e(i)==="random"}),oe=D(ne,1,"",null,oe,{selected:e(i)==="mcts"}),se.disabled=e(r).length===0}),P(a,J),ge()}be(["click"]);export{_t as component};
