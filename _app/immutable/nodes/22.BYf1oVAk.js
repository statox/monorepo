import"../chunks/DsnmJJEf.js";import{o as j,a as U}from"../chunks/vjUZdrab.js";import{p as T,b as C,e as r,s as d,t as R,a as x,d as M,r as l,a$ as L,by as W,i as I,h as H,g as k,c as O,f as q,n as K,F as N,a1 as z}from"../chunks/eXUqL77E.js";import{d as A,s as Q,e as G}from"../chunks/BemXrffE.js";import{s as V,b as Y}from"../chunks/CujdopWx.js";import{m as J}from"../chunks/BuqJaIpI.js";import{p as D}from"../chunks/TtEguMge.js";import{N as X}from"../chunks/DIZDbMwu.js";import{i as F}from"../chunks/CTMdkGpN.js";import{P as $}from"../chunks/Bsmh5y_W.js";import{T as tt}from"../chunks/DP3j-b_7.js";import{M as et}from"../chunks/utk3oDie.js";import"../chunks/ctDXYmCv.js";import"../chunks/CyJkcRSJ.js";import{p as it}from"../chunks/B4-ntoLf.js";/* empty css                */import"../chunks/B0neLVfT.js";class st{audioContext;notesInQueue=[];currentBeatInBar;beatsPerBar;currentSubdivision;subdivisionsInBeat;tempo;lookahead;scheduleAheadTime;nextNoteTime;isRunning;intervalID;onBeatStart;onBeatEnd;constructor(e=80){this.audioContext=null,this.notesInQueue=[],this.currentBeatInBar=0,this.currentSubdivision=0,this.subdivisionsInBeat=1,this.beatsPerBar=4,this.tempo=e,this.lookahead=25,this.scheduleAheadTime=.1,this.nextNoteTime=0,this.isRunning=!1,this.intervalID=null}nextNote(){const e=60/this.subdivisionsInBeat/this.tempo;this.nextNoteTime+=e,this.currentSubdivision++,this.currentSubdivision>=this.subdivisionsInBeat&&(this.currentBeatInBar++,this.currentSubdivision=0),this.currentBeatInBar>=this.beatsPerBar&&(this.currentBeatInBar=0)}scheduleNote(e,t,s){if(!this.audioContext)return;this.notesInQueue.push({note:e,time:s});const a=this.audioContext.createOscillator(),n=this.audioContext.createGain(),u=1e3,h=400,m=200;t!==0?a.frequency.value=m:e%this.beatsPerBar===0?a.frequency.value=u:a.frequency.value=h,n.gain.value=1,n.gain.exponentialRampToValueAtTime(1,s+.001),n.gain.exponentialRampToValueAtTime(.001,s+.02),a.connect(n),n.connect(this.audioContext.destination);const o=this.audioContext.createConstantSource();o.onended=()=>{this.onBeatStart?.(e,t),a.start(),a.stop(s+.03),a.onended=()=>{this.onBeatEnd?.()}},o.start(s),o.stop(this.audioContext.currentTime+1e-4)}scheduler(){if(this.audioContext)for(;this.nextNoteTime<this.audioContext.currentTime+this.scheduleAheadTime;)this.scheduleNote(this.currentBeatInBar,this.currentSubdivision,this.nextNoteTime),this.nextNote()}start(){this.isRunning||(this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.isRunning=!0,this.currentBeatInBar=0,this.currentSubdivision=0,this.nextNoteTime=this.audioContext.currentTime+.05,this.intervalID=setInterval(()=>this.scheduler(),this.lookahead))}stop(){this.isRunning=!1,this.intervalID&&clearInterval(this.intervalID)}startStop(){this.isRunning?this.stop():this.start()}}var at=C('<div class="controls-container svelte-8u7cmv"><div class="controls-sub-container svelte-8u7cmv"><label for="beatsInBar"><h4>Beats in bar</h4></label> <div class="subdivisions-container svelte-8u7cmv"><button>-1</button> <span style="font-size: large; margin-left: 1em; margin-right: 1em"> </span> <button>+1</button></div></div> <br/> <div class="controls-sub-container svelte-8u7cmv"><label for="subdivisionsInBeat"><h4>Subdivisions in beat</h4></label> <div class="subdivisions-container svelte-8u7cmv"><button aria-label="1 subdivision by beat"><svg width="15" height="15" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 15px; height: auto;"><path d="M 4.3 0 v 9.6 A 2.9 2.9 0 0 0 0 12.1 A 3 3 0 0 0 3 15 c 1.5 0 2.8 -1.3 2.8 -2.9 V 3 V 0 H 4.3 Z"></path></svg></button> <button aria-label="2 subdivision by beat"><svg width="15" height="15" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 15px; height: auto;"><path d="M4.3 0v9.6A2.9 2.9 0 0 0 0 12.1 3 3 0 0 0 3 15c1.5 0 2.8-1.3 2.8-2.9V3h7.7v6.6a2.9 2.9 0 0 0-4.3 2.5 2.9 2.9 0 0 0 5.8 0V0H4.3Z"></path></svg></button> <button aria-label="3 subdivision by beat"><svg width="24" height="21" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 24px; height: auto; top: -3px;"><path clip-rule="evenodd" d="M4.3 15.6V6H24v12.1a3 3 0 0 1-3 2.9 2.9 2.9 0 0 1-2.8-2.9 2.9 2.9 0 0 1 4.3-2.5V9H15v9.1a2.9 2.9 0 0 1-3 2.9 3 3 0 0 1-3-2.9 2.9 2.9 0 0 1 3-2.8c.5 0 1 0 1.3.3V9H5.8v9.1C5.8 19.7 4.5 21 3 21a3 3 0 0 1-3-2.9 2.9 2.9 0 0 1 4.3-2.5Z"></path><path d="M12.6 2.2 13.9.5V0h-3.1v.4h2.5l-1.4 1.7v.4h.4c.9 0 1.3.4 1.3 1s-.4 1-1.2 1c-.7 0-1.3-.3-1.6-.6l-.2.4c.4.4 1 .6 1.8.6 1.1 0 1.7-.6 1.7-1.4 0-.8-.5-1.3-1.5-1.4Z"></path></svg></button> <button aria-label="4 subdivision by beat"><svg width="27" height="13" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 27px; height: auto;"><path clip-rule="evenodd" d="M3.5 0v7.9a2 2 0 0 0-1.1-.3C1 7.6 0 8.6 0 9.9c0 1.3 1 2.4 2.4 2.4 1.3 0 2.3-1 2.3-2.4V3.4H11V8a2 2 0 0 0-1.1-.3 2.3 2.3 0 1 0 0 4.7c1.3 0 2.4-1 2.4-2.4V3.4h6.1V8a2.4 2.4 0 0 0-1-.3c-1.4 0-2.5 1-2.5 2.3 0 1.3 1.1 2.4 2.4 2.4 1.3 0 2.4-1 2.4-2.4V3.4h6.2V8l-1.2-.3c-1.3 0-2.3 1-2.3 2.3a2.3 2.3 0 1 0 4.7 0V0H3.5Zm7.4 2.7H4.7V1.5H11v1.2Zm7.4 0h-6.1V1.5h6.1v1.2Zm1.3 0h6.2V1.5h-6.2v1.2Z"></path></svg></button></div></div></div>');function nt(b,e){T(e,!0);var t=at(),s=r(t),a=d(r(s),2),n=r(a);n.__click=()=>e.onBeatsPerBarUpdate(Math.max(e.beatsPerBar-1,1));var u=d(n,2),h=r(u,!0);l(u);var m=d(u,2);m.__click=()=>e.onBeatsPerBarUpdate(Math.min(e.beatsPerBar+1,10)),l(a),l(s);var o=d(s,4),v=d(r(o),2),p=r(v);p.__click=()=>e.onSubdivisionsInBeatUpdate(1);let w;var y=d(p,2);y.__click=()=>e.onSubdivisionsInBeatUpdate(2);let i;var B=d(y,2);B.__click=()=>e.onSubdivisionsInBeatUpdate(3);let c;var _=d(B,2);_.__click=()=>e.onSubdivisionsInBeatUpdate(4);let S;l(v),l(o),l(t),R(()=>{Q(h,e.beatsPerBar),w=V(p,1,"",null,w,{selected:e.subdivisionsInBeat===1}),i=V(y,1,"",null,i,{selected:e.subdivisionsInBeat===2}),c=V(B,1,"",null,c,{selected:e.subdivisionsInBeat===3}),S=V(_,1,"",null,S,{selected:e.subdivisionsInBeat===4})}),x(b,t),M()}A(["click"]);function ot(b,e){T(e,!0);let t=D(e,"tempo",15);X(b,{min:1,max:400,step:1,unit:"BPM",decimals:0,adjustmentButtons:[-5,-1,1,5],get value(){return t()},set value(s){t(s)}}),M()}var rt=W('<svg width="20" height="20" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 20px; height: auto;"><path d="M 0 0 V 20 L 6 20 L 6 0 L 0 0 M 9 0 V 20 H 15 V 0 H 9"></path></svg>'),lt=W('<svg width="20" height="20" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 20px; height: auto;"><path d="M 0 0 V 20 L 17 10"></path></svg>'),ut=C('<div class="controls-container svelte-vxo2tw"><button style="min-width: 300px"><!></button></div>');function dt(b,e){T(e,!0);const t=()=>{e.metronome.startStop()},s=o=>{if([" "].includes(o.key)&&(o.preventDefault(),o.key===" ")){t();return}};var a=ut();G("keydown",L,s);var n=r(a);n.__click=t;var u=r(n);{var h=o=>{var v=rt();x(o,v)},m=o=>{var v=lt();x(o,v)};F(u,o=>{e.metronome.isRunning?o(h):o(m,!1)})}l(n),l(a),x(b,a),M()}A(["click"]);var ht=C('<div id="canvas-container" class="d-flex justify-content-center"><!></div>');function vt(b,e){T(e,!0);let t=D(e,"metronome",15),s=!1,a=0,n=0;const u=(i,B)=>{s=!0,a=i,n=B},h=()=>{s=!1};let m,o="white",v="white";const p=i=>{i.setup=()=>{m=i,i.createCanvas(600,300),i.textSize(40)},i.draw=()=>{const B=document.getElementById("canvas-container");if(B){const f=B?.clientWidth||600;i.width!==f&&i.resizeCanvas(f,Math.max(f/3,100))}i.clear(),i.stroke(o);const c=Math.min(i.width/t().beatsPerBar,i.height),_=i.height/t().subdivisionsInBeat;for(let f=0;f<t().beatsPerBar;f++){f===a?i.strokeWeight(5):i.strokeWeight(1),i.noFill(),i.circle(f*c+c/2,i.height/2,c*.9),i.strokeWeight(1);for(let P=0;P<t().subdivisionsInBeat;P++)s&&f===a&&P===n?i.fill(o):i.noFill(),i.circle(f*c+c/2,P*_+_/2,c/t().subdivisionsInBeat*.9)}s?i.fill(v):i.fill(o),i.fill(o);const S=(a+1).toString();i.text(S,a*c+c/2-i.textWidth(S)/2,i.height/2+i.textSize()/2)}};j(()=>{const i=getComputedStyle(document.body);o=i.getPropertyValue("--nc-tx-3"),v=i.getPropertyValue("--nc-tx-2"),t(t().onBeatStart=u,!0),t(t().onBeatEnd=h,!0)}),U(()=>{m?.remove()});var w=ht(),y=r(w);$(y,{sketch:p}),l(w),x(b,w),M()}var ct=C('<div class="controls-container svelte-7ka7d9"><button>Tap</button></div>');function bt(b,e){T(e,!0);let t=new tt,s=H(!1);const a=()=>{t.addBeat(),I(s,!0),setTimeout(()=>I(s,!1),100),t.bpm>0&&e.onNewBPM(Math.ceil(t.bpm))};var n=ct(),u=r(n);u.__click=a;let h;l(n),R(()=>h=V(u,1,"svelte-7ka7d9",null,h,{taped:k(s)})),x(b,n),M()}A(["click"]);var mt=C(`<div role="dialog" class="modal svelte-ezojap"><div class="contents svelte-ezojap"><h4 class="title-bar svelte-ezojap">Metronome <button>Close</button></h4> <div>This is a simple metronome: <ul><li>Use the play/pause button or the space bar to start and stop the metronome</li> <li>You can change the tempo by:</li> <ul><li>Entering a number directly in the input</li> <li>Using the -5, -1, +1 and +5 buttons</li> <li>Taping a tempo on the tap button. When taping the tempo each tap counts
                            for a subdivision if subdivisions are enabled. Stop taping for approx. 3
                            seconds to restart the tap counter.</li></ul> <li>The "Beats in bar" setting change the number of beats counted by the
                        metronome. The first beat is accented with a higher frequency tone.</li> <li>The "Subdivisions in beat" setting allow to change how the beats are
                        divided. The subdivisions after the first one are played with a lower
                        frequency tone.</li> <li>The visualization at the bottom follow the beats and their subdivisions.</li></ul></div> <br/> <h5>Bugs</h5> <ul><li>While it goes against my opinion on what the web should look like, this page
                    works better with Chrome-based browsers.</li> <li>For some reason the display of the tempo settings is broken on Firefox, the
                    input doesn't resize properly.</li> <li>The sound doesn't work on Safari on iOS (and maybe on MacOS too).</li></ul></div></div>`);function ft(b,e){var t=O(),s=q(t);{var a=n=>{var u=mt(),h=r(u),m=r(h),o=d(r(m));o.__click=function(...v){e.close?.apply(this,v)},l(m),K(8),l(h),l(u),x(n,u)};F(s,n=>{e.isOpen&&n(a)})}x(b,t)}A(["click"]);var gt=C('<!> <div class="main svelte-iy8fh1"><h3>Metronome <span><button aria-label="info"><i class="fa fa-info-circle" aria-hidden="true"></i></button></span></h3> <div><!></div> <div class="section svelte-iy8fh1"><!> <!></div> <div class="section svelte-iy8fh1"><!></div> <div class="section svelte-iy8fh1"><!></div></div>',1);function zt(b,e){T(e,!0),it.set({name:"Metronome"});let t=new st(80),s=H(N(t.tempo)),a=H(N(t.beatsPerBar)),n=H(N(t.subdivisionsInBeat));z(()=>{t.tempo=k(s)}),z(()=>{t.beatsPerBar=k(a)}),z(()=>{t.subdivisionsInBeat=k(n)}),U(()=>{t.stop()});const u=g=>{I(a,g,!0),t.beatsPerBar=g},h=g=>{I(n,g,!0),t.subdivisionsInBeat=g};var m=gt(),o=q(m);et(o,{title:"Metronome",description:"Metronome"});var v=d(o,2),p=r(v),w=d(r(p)),y=r(w);y.__click=()=>J.open(ft),Y(y,"",{},{position:"relative"}),l(w),l(p);var i=d(p,2),B=r(i);dt(B,{get metronome(){return t}}),l(i);var c=d(i,2),_=r(c);ot(_,{get tempo(){return k(s)},set tempo(g){I(s,g,!0)}});var S=d(_,2);bt(S,{onNewBPM:g=>I(s,g/t.subdivisionsInBeat)}),l(c);var f=d(c,2),P=r(f);nt(P,{onBeatsPerBarUpdate:u,onSubdivisionsInBeatUpdate:h,get beatsPerBar(){return k(a)},set beatsPerBar(g){I(a,g,!0)},get subdivisionsInBeat(){return k(n)},set subdivisionsInBeat(g){I(n,g,!0)}}),l(f);var E=d(f,2),Z=r(E);vt(Z,{get metronome(){return t}}),l(E),l(v),x(b,m),M()}A(["click"]);export{zt as component};
