import"../chunks/DsnmJJEf.js";import{w as Ye,y as Ze,p as Me,c as ke,f as xe,a as i,d as De,b as q,g as e,D as qe,s as m,e as v,r as l,t as D,j as $e,h as be,F as Oe,aI as f,n as Ne,i as _e,by as se}from"../chunks/eXUqL77E.js";import{d as je,s as N,e as Se}from"../chunks/BemXrffE.js";import{i as G}from"../chunks/CTMdkGpN.js";import{M as Qe}from"../chunks/BLEaYA2t.js";import{M as et}from"../chunks/utk3oDie.js";import"../chunks/ctDXYmCv.js";import{o as Xe}from"../chunks/vjUZdrab.js";import{e as ie,i as ve}from"../chunks/D9zXBg3D.js";import{b as Pe,s as tt,a as c,r as Ve,e as Je}from"../chunks/CujdopWx.js";import{i as at}from"../chunks/UpJSkP_W.js";import{a as Ee,s as He}from"../chunks/y59AJ40k.js";import{M as Ae}from"../chunks/71ylWyng.js";import{j as Ce,p as Be}from"../chunks/CnfZ9F3w.js";import{D as ce}from"../chunks/CkcISRbr.js";import{g as Ie}from"../chunks/ChxXT4D8.js";import{S as ot,P as nt}from"../chunks/DTVyES5u.js";import{p as ze}from"../chunks/TtEguMge.js";import"../chunks/CaxU5mzv.js";import{p as rt}from"../chunks/B4-ntoLf.js";/* empty css                */class Ge{#e=new WeakMap;#t;#a;static entries=new WeakMap;constructor(h){this.#a=h}observe(h,V){var j=this.#e.get(h)||new Set;return j.add(V),this.#e.set(h,j),this.#o().observe(h,this.#a),()=>{var u=this.#e.get(h);u.delete(V),u.size===0&&(this.#e.delete(h),this.#t.unobserve(h))}}#o(){return this.#t??(this.#t=new ResizeObserver(h=>{for(var V of h){Ge.entries.set(V.target,V);for(var j of this.#e.get(V.target)||[])j(V)}}))}}var st=new Ge({box:"border-box"});function Re(de,h,V){var j=st.observe(de,()=>V(de[h]));Ye(()=>(Ze(()=>V(de[h])),j))}var lt=q("<p>Loading events</p>"),it=q('<span class="emoji-value svelte-cyscl8"> </span>'),vt=q('<span class="emoji-value svelte-cyscl8"> </span>'),ct=q('<span class="emoji-value svelte-cyscl8"> </span>'),dt=q('<button class="emotion-item svelte-cyscl8"> </button>'),ut=q('<div class="selection svelte-cyscl8"></div>'),gt=q('<div class="journal-text svelte-cyscl8"> </div>'),mt=q('<button class="journal-toggle svelte-cyscl8"> </button> <!>',1),ht=q('<div class="event svelte-cyscl8"><div class="event-date svelte-cyscl8"> </div> <div class="event-value svelte-cyscl8" data-label="Mood:"><!></div> <div class="event-value svelte-cyscl8" data-label="Energy:"><!></div> <div class="event-value svelte-cyscl8" data-label="Weight:"><!></div> <div class="event-value svelte-cyscl8" data-label="Workplace:"><!></div> <div class="event-value svelte-cyscl8" data-label="Emotions:"><!></div> <div class="event-value journal-cell svelte-cyscl8"><!></div> <div class="event-actions svelte-cyscl8"><button class="svelte-cyscl8">Edit</button></div></div>'),ft=q('<div class="events-header svelte-cyscl8"><div>Date</div> <div>Mood</div> <div>Energy</div> <div>Weight</div> <div>Workplace</div> <div>Emotions</div> <div>Journal</div> <div>Actions</div></div> <!>',1);function xt(de,h){Me(h,!1);const V=()=>Ee(Be,"$personalTrackerPassword",u),j=()=>Ee(Ce,"$eventsStore",u),[u,le]=He();Xe(()=>{Ce.fetch(V())});const x=M=>{Ie(`/personal-tracker/add/${M}`)},Q=["üò¢","üòü","üòï","üòê","üôÇ","üòä","üòÑ","üòÅ","ü§©","üòç"],te=["üò¥","üò™","ü•±","üòë","üòê","üôÇ","üòä","üòÑ","‚ö°","üîã"],ee=new ot,d=M=>{ee.has(M)?ee.delete(M):ee.add(M)};at();var s=ke(),y=xe(s);{var H=M=>{var X=lt();i(M,X)},J=M=>{var X=ke(),z=xe(X);{var k=A=>{{let T=qe(()=>({level:"error",header:"Something went wrong getting events",message:j().error.message}));Ae(A,{get item(){return e(T)}})}},C=A=>{var T=ft(),Y=m(xe(T),2);ie(Y,1,()=>j().events.sort((I,U)=>U.eventDateUnix-I.eventDateUnix),ve,(I,U)=>{const Z=qe(()=>ce.fromSeconds(e(U).eventDateUnix).toFormat("EEEE, d MMMM yyyy")),ne=qe(()=>ee.has(e(U).eventDateUnix));var E=ht(),ge=v(E),g=v(ge,!0);l(ge);var a=m(ge,2),o=v(a);{var t=F=>{var _=it(),R=v(_);l(_),D(()=>N(R,`${Q[e(U).mood-1]??""}
                        ${e(U).mood??""}`)),i(F,_)},r=F=>{var _=$e("-");i(F,_)};G(o,F=>{e(U).mood!==void 0?F(t):F(r,!1)})}l(a);var n=m(a,2),w=v(n);{var B=F=>{var _=vt(),R=v(_);l(_),D(()=>N(R,`${te[e(U).energy-1]??""}
                        ${e(U).energy??""}`)),i(F,_)},P=F=>{var _=$e("-");i(F,_)};G(w,F=>{e(U).energy!==void 0?F(B):F(P,!1)})}l(n);var ae=m(n,2),we=v(ae);{var oe=F=>{var _=$e();D(R=>N(_,`${R??""} kg`),[()=>(e(U).weight/100).toFixed(1)]),i(F,_)},K=F=>{var _=$e("-");i(F,_)};G(we,F=>{e(U).weight!==void 0?F(oe):F(K,!1)})}l(ae);var b=m(ae,2),W=v(b);{var O=F=>{var _=ct(),R=v(_,!0);l(_),D(()=>N(R,e(U).workplace==="remote"?"üè†":"üè¢")),i(F,_)},$=F=>{var _=$e("-");i(F,_)};G(W,F=>{e(U).workplace!==void 0?F(O):F($,!1)})}l(b);var re=m(b,2),fe=v(re);{var ue=F=>{var _=ut();ie(_,5,()=>e(U).emotionwheel.emotions,ve,(R,pe)=>{var Te=dt(),We=v(Te);l(Te),D(()=>{Pe(Te,`--color: ${e(pe).color??""}`),N(We,`${e(pe).category??""}
                                ${e(pe).subcategory??""}
                                ${e(pe).emotion??""}`)}),i(R,Te)}),l(_),i(F,_)},me=F=>{var _=$e("-");i(F,_)};G(fe,F=>{e(U).emotionwheel?.emotions?F(ue):F(me,!1)})}l(re);var L=m(re,2),S=v(L);{var p=F=>{var _=mt(),R=xe(_);R.__click=()=>d(e(U).eventDateUnix);var pe=v(R,!0);l(R);var Te=m(R,2);{var We=Le=>{var Fe=gt(),Ke=v(Fe,!0);l(Fe),D(()=>N(Ke,e(U).journal)),i(Le,Fe)};G(Te,Le=>{e(ne)&&Le(We)})}D(()=>N(pe,e(ne)?"üìñ Hide":"üìù Show")),i(F,_)},he=F=>{var _=$e("-");i(F,_)};G(S,F=>{e(U).journal!==void 0?F(p):F(he,!1)})}l(L);var ye=m(L,2),Ue=v(ye);Ue.__click=()=>x(e(U).eventDateUnix),l(ye),l(E),D(()=>N(g,e(Z))),i(I,E)}),i(A,T)};G(z,A=>{j().error?A(k):A(C,!1)},!0)}i(M,X)};G(y,M=>{j().loading?M(H):M(J,!1)})}i(de,s),De(),le()}je(["click"]);var yt=q("<p>Loading events</p>"),pt=q('<div class="add-indicator svelte-juywa"><span class="plus-sign svelte-juywa">+</span></div>'),_t=q('<div class="indicator mood svelte-juywa"> </div>'),wt=q('<div class="indicator weight svelte-juywa">W</div>'),bt=q('<div class="indicator emotions svelte-juywa">E</div>'),Mt=q('<div class="indicator workplace svelte-juywa"> </div>'),Dt=q('<div class="indicator energy svelte-juywa"> </div>'),kt=q('<div class="indicator journal svelte-juywa" title="Journal entry">üìù</div>'),Ut=q('<div class="event-indicators svelte-juywa"><!> <!> <!> <!> <!> <!></div>'),$t=q('<div role="button" tabindex="0"><div class="day-number svelte-juywa"> </div> <!> <!></div>'),St=q('<div class="calendar-container svelte-juywa"><div class="calendar-header svelte-juywa"><button class="nav-button svelte-juywa">&lt;</button> <h3 class="month-year svelte-juywa"> </h3> <button class="nav-button svelte-juywa">&gt;</button> <button class="today-button svelte-juywa">Today</button></div> <div class="calendar-grid svelte-juywa"><div class="day-name svelte-juywa">Mon</div> <div class="day-name svelte-juywa">Tue</div> <div class="day-name svelte-juywa">Wed</div> <div class="day-name svelte-juywa">Thu</div> <div class="day-name svelte-juywa">Fri</div> <div class="day-name svelte-juywa">Sat</div> <div class="day-name svelte-juywa">Sun</div> <!></div> <div class="calendar-legend svelte-juywa"><div class="legend-item svelte-juywa"><div class="indicator mood svelte-juywa">5</div> <span>Mood</span></div> <div class="legend-item svelte-juywa"><div class="indicator weight svelte-juywa">W</div> <span>Weight</span></div> <div class="legend-item svelte-juywa"><div class="indicator emotions svelte-juywa">E</div> <span>Emotions</span></div> <div class="legend-item svelte-juywa"><div class="indicator workplace svelte-juywa">üè†</div> <span>Workplace</span></div> <div class="legend-item svelte-juywa"><div class="indicator energy svelte-juywa">5</div> <span>Energy</span></div> <div class="legend-item svelte-juywa"><div class="indicator journal svelte-juywa">üìù</div> <span>Journal</span></div></div></div>');function jt(de,h){Me(h,!0);const V=()=>Ee(Be,"$personalTrackerPassword",u),j=()=>Ee(Ce,"$eventsStore",u),[u,le]=He();let x=be(Oe(ce.now().startOf("month")));Xe(()=>{Ce.fetch(V())});const Q=()=>{_e(x,e(x).minus({months:1}),!0)},te=()=>{_e(x,e(x).plus({months:1}),!0)},ee=()=>{_e(x,ce.now().startOf("month"),!0)},d=k=>{Ie(`/personal-tracker/add/${k}`)},s=(k,C)=>{const A=k.startOf("month"),Y=A.weekday-1,I=42,U=[];let Z=A.minus({days:Y});for(let ne=0;ne<I;ne++){const E=Z.toUTC().plus({days:1}).startOf("day").toUnixInteger(),ge=C.find(o=>o.eventDateUnix===E),g=Z.month===k.month,a=Z.hasSame(ce.now(),"day");U.push({date:Z,timestamp:E,event:ge,isCurrentMonth:g,isToday:a}),Z=Z.plus({days:1})}return U},y=f(()=>s(e(x),j().events)),H=f(()=>e(x).toFormat("MMMM yyyy"));var J=ke(),M=xe(J);{var X=k=>{var C=yt();i(k,C)},z=k=>{var C=ke(),A=xe(C);{var T=I=>{{let U=f(()=>({level:"error",header:"Something went wrong getting events",message:j().error.message}));Ae(I,{get item(){return e(U)}})}},Y=I=>{var U=St(),Z=v(U),ne=v(Z);ne.__click=Q;var E=m(ne,2),ge=v(E,!0);l(E);var g=m(E,2);g.__click=te;var a=m(g,2);a.__click=ee,l(Z);var o=m(Z,2),t=m(v(o),14);ie(t,17,()=>e(y),ve,(r,n)=>{var w=$t();let B;w.__click=()=>d(e(n).timestamp);var P=v(w),ae=v(P,!0);l(P);var we=m(P,2);{var oe=W=>{var O=pt();i(W,O)};G(we,W=>{e(n).event||W(oe)})}var K=m(we,2);{var b=W=>{var O=Ut(),$=v(O);{var re=_=>{var R=_t(),pe=v(R,!0);l(R),D(()=>{c(R,"title",`Mood: ${e(n).event.mood??""}`),N(pe,e(n).event.mood)}),i(_,R)};G($,_=>{e(n).event.mood!==void 0&&_(re)})}var fe=m($,2);{var ue=_=>{var R=wt();D(pe=>c(R,"title",`Weight: ${pe??""} kg`),[()=>(e(n).event.weight/100).toFixed(1)]),i(_,R)};G(fe,_=>{e(n).event.weight!==void 0&&_(ue)})}var me=m(fe,2);{var L=_=>{var R=bt();D(()=>c(R,"title",`${e(n).event.emotionwheel.emotions.length??""} emotions`)),i(_,R)};G(me,_=>{e(n).event.emotionwheel?.emotions&&_(L)})}var S=m(me,2);{var p=_=>{var R=Mt(),pe=v(R,!0);l(R),D(()=>{c(R,"title",`Workplace: ${e(n).event.workplace??""}`),N(pe,e(n).event.workplace==="remote"?"üè†":"üè¢")}),i(_,R)};G(S,_=>{e(n).event.workplace!==void 0&&_(p)})}var he=m(S,2);{var ye=_=>{var R=Dt(),pe=v(R,!0);l(R),D(()=>{c(R,"title",`Energy: ${e(n).event.energy??""}`),N(pe,e(n).event.energy)}),i(_,R)};G(he,_=>{e(n).event.energy!==void 0&&_(ye)})}var Ue=m(he,2);{var F=_=>{var R=kt();i(_,R)};G(Ue,_=>{e(n).event.journal!==void 0&&_(F)})}l(O),i(W,O)};G(K,W=>{e(n).event&&W(b)})}l(w),D(()=>{B=tt(w,1,"calendar-day svelte-juywa",null,B,{"other-month":!e(n).isCurrentMonth,"has-event":e(n).event,today:e(n).isToday}),N(ae,e(n).date.day)}),i(r,w)}),l(o),Ne(2),l(U),D(()=>N(ge,e(H))),i(I,U)};G(A,I=>{j().error?I(T):I(Y,!1)},!0)}i(k,C)};G(M,k=>{j().loading?k(X):k(z,!1)})}i(de,J),De(),le()}je(["click"]);var Tt=q('<div class="time-window-picker svelte-1hdulpl"><div class="date-field svelte-1hdulpl"><label for="start-date" class="svelte-1hdulpl">From</label> <input type="date" id="start-date" class="svelte-1hdulpl"/></div> <div class="date-field svelte-1hdulpl"><label for="end-date" class="svelte-1hdulpl">To</label> <div class="end-date-row svelte-1hdulpl"><input type="date" id="end-date" class="svelte-1hdulpl"/> <button type="button" class="now-btn svelte-1hdulpl" title="Set to today">Today</button></div></div></div>');function Et(de,h){Me(h,!0);let V=ze(h,"startDate",15),j=ze(h,"endDate",15);const u=k=>ce.fromMillis(k).toFormat("yyyy-MM-dd"),le=k=>ce.fromFormat(k,"yyyy-MM-dd").toMillis();let x=f(()=>u(V())),Q=f(()=>u(j()));const te=k=>{const C=k.target;C.value&&V(le(C.value))},ee=k=>{const C=k.target;C.value&&j(le(C.value))},d=()=>{j(ce.now().startOf("day").toMillis())};var s=Tt(),y=v(s),H=m(v(y),2);Ve(H),H.__change=te,l(y);var J=m(y,2),M=m(v(J),2),X=v(M);Ve(X),X.__change=ee;var z=m(X,2);z.__click=d,l(M),l(J),l(s),D(()=>{Je(H,e(x)),Je(X,e(Q))}),i(de,s),De()}je(["change","click"]);var Ct=q('<p class="no-data svelte-ja7tye">No emotions recorded in this time period</p>'),Pt=se('<line class="grid-line svelte-ja7tye"></line>'),Wt=se('<line class="monday-line svelte-ja7tye"></line>'),Lt=se('<rect class="bar svelte-ja7tye"><title> </title></rect>'),Ft=se('<text class="axis-label svelte-ja7tye" text-anchor="end"> </text>'),qt=se('<text class="axis-label svelte-ja7tye" text-anchor="middle"> </text>'),Ot=se('<text text-anchor="middle" class="hover-date svelte-ja7tye"> </text>'),Xt=se('<line class="hover-line svelte-ja7tye"></line><!>',1),Ht=q('<div class="legend-item svelte-ja7tye"><span class="legend-color svelte-ja7tye"></span> <span class="legend-label svelte-ja7tye"> </span></div>'),At=q('<div class="chart-container svelte-ja7tye"><svg class="bar-chart svelte-ja7tye"><g class="grid"></g><g class="monday-lines"></g><g></g><g class="y-axis"></g><g class="x-axis"></g><!></svg> <div class="legend svelte-ja7tye"></div></div>'),Bt=q('<div class="emotions-daily-bars svelte-ja7tye"><h3 class="svelte-ja7tye">Daily Emotions by Category</h3> <!></div>');function It(de,h){Me(h,!0);let V=be(600);const j=300,u={top:20,right:20,bottom:50,left:40};let le=f(()=>Math.max(e(V),450)),x=f(()=>e(le)-u.left-u.right);const Q=j-u.top-u.bottom;let te=f(()=>[...h.events].filter(g=>g.emotionwheel?.emotions?.length).sort((g,a)=>g.eventDateUnix-a.eventDateUnix)),ee=f(()=>{const g=new Map;for(const a of e(te))if(a.emotionwheel?.emotions)for(const o of a.emotionwheel.emotions)g.has(o.category)||g.set(o.category,o.color);return g}),d=f(()=>Array.from(e(ee).keys()).sort()),s=f(()=>{if(e(te).length===0)return[];const g=new Map;for(const a of e(te)){const o=ce.fromSeconds(a.eventDateUnix).startOf("day"),t=o.toISO();g.has(t)||g.set(t,{date:o,dateUnix:o.toSeconds(),counts:new Map,total:0});const r=g.get(t);if(a.emotionwheel?.emotions)for(const n of a.emotionwheel.emotions){const w=r.counts.get(n.category)||0;r.counts.set(n.category,w+1),r.total++}}return Array.from(g.values()).sort((a,o)=>a.dateUnix-o.dateUnix)}),y=f(()=>{let g=1;for(const a of e(s))for(const o of a.counts.values())o>g&&(g=o);return g}),H=f(()=>{if(e(s).length===0)return()=>0;const g=e(s)[0].dateUnix,o=e(s)[e(s).length-1].dateUnix-g||1;return t=>(t-g)/o*e(x)}),J=f(()=>{if(e(s).length===0)return 20;if(e(s).length===1)return Math.min(20,e(x)*.8/Math.max(e(d).length,1));let g=1/0;for(let t=1;t<e(s).length;t++){const r=e(H)(e(s)[t].dateUnix)-e(H)(e(s)[t-1].dateUnix);r<g&&(g=r)}const o=g*.8/Math.max(e(d).length,1);return Math.max(3,Math.min(20,o))}),M=f(()=>e(J)*e(d).length),X=f(()=>g=>Q-g/e(y)*Q*.9),z=f(()=>{const g=[];return e(s).forEach(a=>{const t=e(H)(a.dateUnix)-e(M)/2;e(d).forEach((r,n)=>{const w=a.counts.get(r)||0;if(w>0){const B=t+n*e(J),P=w/e(y)*Q*.9;g.push({x:B,y:Q-P,width:e(J)-1,height:P,color:e(ee).get(r)||"#888",category:r,count:w,date:a.date})}})}),g}),k=f(()=>{if(e(s).length===0)return[];const g=10,a=[];if(e(s).length<=g)e(s).forEach(o=>{a.push({x:e(H)(o.dateUnix),label:o.date.toFormat("dd/MM")})});else{const o=Math.ceil(e(s).length/g);for(let t=0;t<e(s).length;t+=o){const r=e(s)[t];a.push({x:e(H)(r.dateUnix),label:r.date.toFormat("dd/MM")})}}return a}),C=f(()=>{const g=[],a=Math.max(1,Math.ceil(e(y)/5));for(let o=0;o<=e(y);o+=a)g.push(o);return g[g.length-1]<e(y)&&g.push(e(y)),g}),A=f(()=>{const g=new Map;for(const a of e(s))for(const[o,t]of a.counts)g.set(o,(g.get(o)||0)+t);return e(d).map(a=>({category:a,color:e(ee).get(a)||"#888",total:g.get(a)||0})).sort((a,o)=>o.total-a.total)}),T=f(()=>{if(e(s).length===0)return[];const g=e(s)[0].dateUnix,a=e(s)[e(s).length-1].dateUnix;let o=ce.fromSeconds(g).startOf("day");const t=(8-o.weekday)%7;o=o.plus({days:t===0&&o.weekday!==1?7:t});const r=[],n=ce.fromSeconds(a);for(;o<=n;){const w=o.toSeconds();r.push({x:e(H)(w),label:o.toFormat("dd/MM")}),o=o.plus({weeks:1})}return r});const Y=g=>{if(e(s).length===0)return;const o=g.currentTarget.getBoundingClientRect(),r=(g.clientX-o.left)/o.width*e(le)-u.left;if(r>=0&&r<=e(x)){const n=e(s)[0].dateUnix,B=e(s)[e(s).length-1].dateUnix-n||1,P=n+r/e(x)*B;h.onHoverChange(P)}else h.onHoverChange(null)},I=()=>{h.onHoverChange(null)};let U=f(()=>{if(h.hoveredTimestamp===null||e(s).length===0)return null;const g=e(s)[0].dateUnix,a=e(s)[e(s).length-1].dateUnix;return h.hoveredTimestamp<g||h.hoveredTimestamp>a?null:e(H)(h.hoveredTimestamp)});var Z=Bt(),ne=m(v(Z),2);{var E=g=>{var a=Ct();i(g,a)},ge=g=>{var a=At(),o=v(a);o.__mousemove=Y;var t=v(o);ie(t,21,()=>e(C),ve,(oe,K)=>{var b=Pt();D((W,O)=>{c(b,"x1",u.left),c(b,"y1",W),c(b,"x2",e(le)-u.right),c(b,"y2",O)},[()=>u.top+e(X)(e(K)),()=>u.top+e(X)(e(K))]),i(oe,b)}),l(t);var r=m(t);ie(r,21,()=>e(T),ve,(oe,K)=>{var b=Wt();D(()=>{c(b,"x1",u.left+e(K).x),c(b,"y1",u.top),c(b,"x2",u.left+e(K).x),c(b,"y2",u.top+Q)}),i(oe,b)}),l(r);var n=m(r);ie(n,21,()=>e(z),ve,(oe,K)=>{var b=Lt(),W=v(b),O=v(W);l(W),l(b),D($=>{c(b,"x",e(K).x),c(b,"y",e(K).y),c(b,"width",e(K).width),c(b,"height",e(K).height),c(b,"fill",e(K).color),N(O,`${$??""}: ${e(K).category??""} - ${e(K).count??""}`)},[()=>e(K).date.toFormat("dd MMM")]),i(oe,b)}),l(n);var w=m(n);ie(w,21,()=>e(C),ve,(oe,K)=>{var b=Ft(),W=v(b,!0);l(b),D(O=>{c(b,"x",u.left-8),c(b,"y",O),N(W,e(K))},[()=>u.top+e(X)(e(K))+4]),i(oe,b)}),l(w);var B=m(w);ie(B,21,()=>e(k),ve,(oe,K)=>{var b=qt(),W=v(b,!0);l(b),D(()=>{c(b,"x",u.left+e(K).x),c(b,"y",j-u.bottom+20),N(W,e(K).label)}),i(oe,b)}),l(B);var P=m(B);{var ae=oe=>{var K=Xt(),b=xe(K),W=m(b);{var O=$=>{var re=Ot(),fe=v(re,!0);l(re),D(ue=>{c(re,"x",u.left+e(U)),c(re,"y",u.top-6),N(fe,ue)},[()=>ce.fromSeconds(h.hoveredTimestamp).toFormat("dd/MM")]),i($,re)};G(W,$=>{h.hoveredTimestamp&&$(O)})}D(()=>{c(b,"x1",u.left+e(U)),c(b,"y1",u.top),c(b,"x2",u.left+e(U)),c(b,"y2",u.top+Q)}),i(oe,K)};G(P,oe=>{e(U)!==null&&oe(ae)})}l(o);var we=m(o,2);ie(we,21,()=>e(A),ve,(oe,K)=>{var b=Ht(),W=v(b),O=m(W,2),$=v(O,!0);l(O),l(b),D(()=>{Pe(W,`background-color: ${e(K).color??""}`),N($,e(K).category)}),i(oe,b)}),l(we),l(a),D(()=>{c(o,"viewBox",`0 0 ${e(le)??""} 300`),c(n,"transform",`translate(${u.left}, ${u.top})`)}),Se("mouseleave",o,I),Re(a,"clientWidth",oe=>_e(V,oe)),i(g,a)};G(ne,g=>{e(s).length===0?g(E):g(ge,!1)})}l(Z),i(de,Z),De()}je(["mousemove"]);var Gt=q('<p class="no-data svelte-1u1vngp">No emotions recorded in this time period</p>'),Rt=se('<path class="pie-slice svelte-1u1vngp"><title> </title></path>'),Vt=se('<text class="pie-label svelte-1u1vngp" text-anchor="middle" dominant-baseline="middle"> </text>'),Jt=q('<div class="legend-item svelte-1u1vngp"><span class="legend-color svelte-1u1vngp"></span> <span class="legend-label svelte-1u1vngp"> </span> <span class="legend-count svelte-1u1vngp"> </span></div>'),zt=q('<div class="legend-category svelte-1u1vngp"><div class="category-header svelte-1u1vngp"><span> </span> <span class="category-percentage svelte-1u1vngp"> </span></div> <div class="category-items svelte-1u1vngp"></div></div>'),Nt=q('<div class="chart-wrapper svelte-1u1vngp"><svg viewBox="0 0 300 300" class="pie-chart svelte-1u1vngp"><!><!></svg> <div class="legend svelte-1u1vngp"></div></div>'),Kt=q('<div class="emotions-pie-chart svelte-1u1vngp"><h3 class="svelte-1u1vngp">Emotions Distribution</h3> <!></div>');function Yt(de,h){Me(h,!0);let V=f(()=>{const d=new Map;for(const s of h.events)if(s.emotionwheel?.emotions)for(const y of s.emotionwheel.emotions){const H=d.get(y.emotion);H?H.count++:d.set(y.emotion,{emotion:y.emotion,category:y.category,subcategory:y.subcategory,color:y.color,count:1})}return Array.from(d.values()).sort((s,y)=>s.category!==y.category?s.category.localeCompare(y.category):s.subcategory!==y.subcategory?s.subcategory.localeCompare(y.subcategory):y.count-s.count)}),j=f(()=>e(V).reduce((d,s)=>d+s.count,0)),u=f(()=>{if(e(j)===0)return[];const d=[];let s=-90;const y=150,H=150,J=120;for(const M of e(V)){const X=M.count/e(j)*100,z=X/100*360,k=s,C=s+z,A=k*Math.PI/180,T=C*Math.PI/180,Y=y+J*Math.cos(A),I=H+J*Math.sin(A),U=y+J*Math.cos(T),Z=H+J*Math.sin(T),ne=z>180?1:0,E=`M ${y} ${H} L ${Y} ${I} A ${J} ${J} 0 ${ne} 1 ${U} ${Z} Z`,g=(k+C)/2*Math.PI/180,a=J*.65,o=y+a*Math.cos(g),t=H+a*Math.sin(g);d.push({emotion:M.emotion,color:M.color,count:M.count,percentage:X,startAngle:k,endAngle:C,path:E,labelX:o,labelY:t}),s=C}return d}),le=f(()=>{const d=new Map;for(const s of e(V)){const y=d.get(s.category);y?y.push(s):d.set(s.category,[s])}return Array.from(d.entries()).map(([s,y])=>{const H=y.reduce((M,X)=>M+X.count,0),J=e(j)>0?H/e(j)*100:0;return{category:s,emotions:y,percentage:J}}).sort((s,y)=>y.percentage-s.percentage)});var x=Kt(),Q=m(v(x),2);{var te=d=>{var s=Gt();i(d,s)},ee=d=>{var s=Nt(),y=v(s),H=v(y);ie(H,17,()=>e(u),ve,(X,z)=>{var k=Rt(),C=v(k),A=v(C);l(C),l(k),D(T=>{c(k,"d",e(z).path),c(k,"fill",e(z).color),N(A,`${e(z).emotion??""}: ${e(z).count??""} (${T??""}%)`)},[()=>e(z).percentage.toFixed(1)]),i(X,k)});var J=m(H);ie(J,17,()=>e(u),ve,(X,z)=>{var k=ke(),C=xe(k);{var A=T=>{var Y=Vt(),I=v(Y,!0);l(Y),D(()=>{c(Y,"x",e(z).labelX),c(Y,"y",e(z).labelY),N(I,e(z).emotion)}),i(T,Y)};G(C,T=>{e(z).percentage>=5&&T(A)})}i(X,k)}),l(y);var M=m(y,2);ie(M,21,()=>e(le),ve,(X,z)=>{var k=zt(),C=v(k),A=v(C),T=v(A,!0);l(A);var Y=m(A,2),I=v(Y);l(Y),l(C);var U=m(C,2);ie(U,21,()=>e(z).emotions,ve,(Z,ne)=>{var E=Jt(),ge=v(E),g=m(ge,2),a=v(g,!0);l(g);var o=m(g,2),t=v(o,!0);l(o),l(E),D(()=>{Pe(ge,`background-color: ${e(ne).color??""}`),N(a,e(ne).emotion),N(t,e(ne).count)}),i(Z,E)}),l(U),l(k),D(Z=>{N(T,e(z).category),N(I,`${Z??""}%`)},[()=>e(z).percentage.toFixed(1)]),i(X,k)}),l(M),l(s),i(d,s)};G(Q,d=>{e(u).length===0?d(te):d(ee,!1)})}l(x),i(de,x),De()}var Zt=q('<p class="no-data svelte-g7rcfr">No emotions recorded in this time period</p>'),Qt=se('<line class="monday-line svelte-g7rcfr"></line>'),ea=se('<path class="stream-layer svelte-g7rcfr" opacity="0.85"><title> </title></path>'),ta=se('<circle r="3" class="daily-point svelte-g7rcfr"><title> </title></circle>'),aa=se('<path class="daily-line svelte-g7rcfr"></path><!>',1),oa=se('<text class="axis-label svelte-g7rcfr" text-anchor="middle"> </text>'),na=se('<g class="tooltip"><text x="0" y="0" text-anchor="middle" class="tooltip-date svelte-g7rcfr"> </text></g>'),ra=se('<line class="hover-line svelte-g7rcfr"></line><!>',1),sa=q('<span class="legend-count svelte-g7rcfr"> </span>'),la=q('<div class="legend-item svelte-g7rcfr"><span class="legend-color svelte-g7rcfr"></span> <span class="legend-label svelte-g7rcfr"> </span> <!></div>'),ia=q('<div class="chart-container svelte-g7rcfr"><svg class="stream-chart svelte-g7rcfr"><g class="monday-lines"></g><g><!><!></g><g class="x-axis"></g><!></svg> <div class="legend svelte-g7rcfr"><div class="legend-item svelte-g7rcfr"><span class="legend-line-icon svelte-g7rcfr"></span> <span class="legend-label svelte-g7rcfr">Daily count</span></div> <!></div></div>'),va=q('<div class="emotions-stream-graph svelte-g7rcfr"><h3 class="svelte-g7rcfr">Emotions Trends</h3> <!></div>');function ca(de,h){Me(h,!0);let V=be(600);const j=350,u={top:30,right:20,bottom:40,left:50};let le=f(()=>Math.max(e(V),450)),x=f(()=>e(le)-u.left-u.right);const Q=j-u.top-u.bottom;let te=f(()=>[...h.events].filter(a=>a.emotionwheel?.emotions?.length).sort((a,o)=>a.eventDateUnix-o.eventDateUnix)),ee=f(()=>{const a=new Map;for(const o of e(te))if(o.emotionwheel?.emotions)for(const t of o.emotionwheel.emotions)a.has(t.category)||a.set(t.category,t.color);return a}),d=f(()=>Array.from(e(ee).keys()).sort()),s=f(()=>{if(e(te).length===0)return[];const a=new Map;for(const o of e(te)){const r=ce.fromSeconds(o.eventDateUnix).startOf("week"),n=r.toISO();a.has(n)||a.set(n,{weekStart:r,weekStartUnix:r.toSeconds(),counts:new Map(e(d).map(B=>[B,0])),total:0});const w=a.get(n);if(o.emotionwheel?.emotions)for(const B of o.emotionwheel.emotions){const P=w.counts.get(B.category)||0;w.counts.set(B.category,P+1),w.total++}}return Array.from(a.values()).sort((o,t)=>o.weekStartUnix-t.weekStartUnix)}),y=f(()=>{if(e(s).length===0)return()=>0;const a=e(s)[0].weekStartUnix,t=e(s)[e(s).length-1].weekStartUnix-a||1;return r=>(r-a)/t*e(x)}),H=f(()=>{if(e(s).length===0||e(d).length===0)return[];const a=Math.max(...e(s).map(t=>t.total),1),o=e(d).map(t=>({category:t,color:e(ee).get(t)||"#888",points:[]}));for(const t of e(s)){const r=e(y)(t.weekStartUnix),n=e(d).map(P=>(t.counts.get(P)||0)/a*Q*.8),w=n.reduce((P,ae)=>P+ae,0);let B=(Q-w)/2;for(let P=0;P<e(d).length;P++){const ae=B+n[P];o[P].points.push({x:r,y0:B,y1:ae}),B=ae}}return o});const J=a=>{if(a.length===0)return"";if(a.length===1){const t=a[0];return`M ${t.x-5} ${t.y0} L ${t.x+5} ${t.y0} L ${t.x+5} ${t.y1} L ${t.x-5} ${t.y1} Z`}let o=`M ${a[0].x} ${a[0].y0}`;for(let t=1;t<a.length;t++){const r=a[t-1],n=a[t],w=(r.x+n.x)/2;o+=` C ${w} ${r.y0}, ${w} ${n.y0}, ${n.x} ${n.y0}`}for(let t=a.length-1;t>=0;t--){const r=a[t];if(t===a.length-1)o+=` L ${r.x} ${r.y1}`;else{const n=a[t+1],w=(r.x+n.x)/2;o+=` C ${w} ${n.y1}, ${w} ${r.y1}, ${r.x} ${r.y1}`}}return o+=" Z",o};let M=f(()=>{if(e(T).length===0)return[];const a=e(T)[0].dateUnix,o=e(T)[e(T).length-1].dateUnix;let t=ce.fromSeconds(a).startOf("day");const r=(8-t.weekday)%7;t=t.plus({days:r===0&&t.weekday!==1?7:r});const n=[],w=ce.fromSeconds(o);for(;t<=w;){const B=t.toSeconds();n.push({x:e(y)(B),label:t.toFormat("dd/MM")}),t=t.plus({weeks:1})}return n}),X=f(()=>{if(e(s).length===0)return[];const a=8,o=[];if(e(s).length<=a)for(const t of e(s))o.push({x:e(y)(t.weekStartUnix),label:t.weekStart.toFormat("dd/MM")});else{const t=Math.ceil(e(s).length/a);for(let r=0;r<e(s).length;r+=t){const n=e(s)[r];o.push({x:e(y)(n.weekStartUnix),label:n.weekStart.toFormat("dd/MM")})}}return o});const z=a=>{if(e(T).length===0)return;const t=a.currentTarget.getBoundingClientRect(),n=(a.clientX-t.left)/t.width*e(le)-u.left;if(n>=0&&n<=e(x)){const w=e(T)[0].dateUnix,P=e(T)[e(T).length-1].dateUnix-w||1,ae=w+n/e(x)*P;h.onHoverChange(ae)}else h.onHoverChange(null)},k=()=>{h.onHoverChange(null)};let C=f(()=>{if(h.hoveredTimestamp===null||e(T).length===0)return null;const a=e(T)[0].dateUnix,o=e(T)[e(T).length-1].dateUnix;return h.hoveredTimestamp<a||h.hoveredTimestamp>o?null:e(y)(h.hoveredTimestamp)}),A=f(()=>{if(h.hoveredTimestamp===null||e(s).length===0)return null;let a=e(s)[0],o=Math.abs(a.weekStartUnix-h.hoveredTimestamp);for(const t of e(s)){const r=Math.abs(t.weekStartUnix-h.hoveredTimestamp);r<o&&(o=r,a=t)}return a}),T=f(()=>{if(e(te).length===0)return[];const a=new Map;for(const o of e(te)){const t=ce.fromSeconds(o.eventDateUnix).startOf("day"),r=t.toISO();a.has(r)||a.set(r,{date:t,dateUnix:t.toSeconds(),count:0});const n=a.get(r);o.emotionwheel?.emotions&&(n.count+=o.emotionwheel.emotions.length)}return Array.from(a.values()).sort((o,t)=>o.dateUnix-t.dateUnix)}),Y=f(()=>Math.max(...e(T).map(a=>a.count),1)),I=f(()=>e(T).map(a=>({x:e(y)(a.dateUnix),y:Q-a.count/e(Y)*Q*.9,count:a.count,date:a.date}))),U=f(()=>{if(e(I).length===0)return"";if(e(I).length===1){const o=e(I)[0];return`M ${o.x-2} ${o.y} L ${o.x+2} ${o.y}`}let a=`M ${e(I)[0].x} ${e(I)[0].y}`;for(let o=1;o<e(I).length;o++){const t=e(I)[o-1],r=e(I)[o],n=(t.x+r.x)/2;a+=` C ${n} ${t.y}, ${n} ${r.y}, ${r.x} ${r.y}`}return a}),Z=f(()=>{const a=new Map;for(const o of e(s))for(const[t,r]of o.counts)a.set(t,(a.get(t)||0)+r);return e(d).map(o=>({category:o,color:e(ee).get(o)||"#888",total:a.get(o)||0})).sort((o,t)=>t.total-o.total)});var ne=va(),E=m(v(ne),2);{var ge=a=>{var o=Zt();i(a,o)},g=a=>{var o=ia(),t=v(o);t.__mousemove=z;var r=v(t);ie(r,21,()=>e(M),ve,(W,O)=>{var $=Qt();D(()=>{c($,"x1",u.left+e(O).x),c($,"y1",u.top),c($,"x2",u.left+e(O).x),c($,"y2",u.top+Q)}),i(W,$)}),l(r);var n=m(r),w=v(n);ie(w,17,()=>e(H),ve,(W,O)=>{var $=ea(),re=v($),fe=v(re,!0);l(re),l($),D(ue=>{c($,"d",ue),c($,"fill",e(O).color),N(fe,e(O).category)},[()=>J(e(O).points)]),i(W,$)});var B=m(w);{var P=W=>{var O=aa(),$=xe(O),re=m($);ie(re,17,()=>e(I),ve,(fe,ue)=>{var me=ta(),L=v(me),S=v(L);l(L),l(me),D(p=>{c(me,"cx",e(ue).x),c(me,"cy",e(ue).y),N(S,`${p??""}: ${e(ue).count??""} emotions`)},[()=>e(ue).date.toFormat("dd MMM")]),i(fe,me)}),D(()=>c($,"d",e(U))),i(W,O)};G(B,W=>{e(U)&&W(P)})}l(n);var ae=m(n);ie(ae,21,()=>e(X),ve,(W,O)=>{var $=oa(),re=v($,!0);l($),D(()=>{c($,"x",u.left+e(O).x),c($,"y",j-u.bottom+20),N(re,e(O).label)}),i(W,$)}),l(ae);var we=m(ae);{var oe=W=>{var O=ra(),$=xe(O),re=m($);{var fe=ue=>{var me=na(),L=v(me),S=v(L,!0);l(L),l(me),D(p=>{c(me,"transform",`translate(${u.left+e(C)}, ${u.top-5})`),N(S,p)},[()=>ce.fromSeconds(h.hoveredTimestamp).toFormat("dd/MM")]),i(ue,me)};G(re,ue=>{h.hoveredTimestamp&&ue(fe)})}D(()=>{c($,"x1",u.left+e(C)),c($,"y1",u.top),c($,"x2",u.left+e(C)),c($,"y2",u.top+Q)}),i(W,O)};G(we,W=>{e(C)!==null&&W(oe)})}l(t);var K=m(t,2),b=m(v(K),2);ie(b,17,()=>e(Z),ve,(W,O)=>{var $=la(),re=v($),fe=m(re,2),ue=v(fe,!0);l(fe);var me=m(fe,2);{var L=S=>{var p=sa(),he=v(p,!0);l(p),D(ye=>N(he,ye),[()=>e(A).counts.get(e(O).category)||0]),i(S,p)};G(me,S=>{e(A)&&S(L)})}l($),D(()=>{Pe(re,`background-color: ${e(O).color??""}`),N(ue,e(O).category)}),i(W,$)}),l(K),l(o),D(()=>{c(t,"viewBox",`0 0 ${e(le)??""} 350`),c(n,"transform",`translate(${u.left}, ${u.top})`)}),Se("mouseleave",t,k),Re(o,"clientWidth",W=>_e(V,W)),i(a,o)};G(E,a=>{e(s).length===0?a(ge):a(g,!1)})}l(ne),i(de,ne),De()}je(["mousemove"]);var da=q('<p class="no-data svelte-1q0dbv2">No events recorded in this time period</p>'),ua=se('<line class="grid-line svelte-1q0dbv2"></line>'),ga=se('<line class="monday-line svelte-1q0dbv2"></line>'),ma=se('<path class="line energy-line svelte-1q0dbv2"></path>'),ha=se('<path class="line mood-line svelte-1q0dbv2"></path>'),fa=se('<circle r="4" class="point energy-point svelte-1q0dbv2"></circle>'),xa=se('<circle r="4" class="point mood-point svelte-1q0dbv2"></circle>'),ya=se('<text class="axis-label svelte-1q0dbv2"> </text>'),pa=se('<text class="axis-label svelte-1q0dbv2" text-anchor="middle"> </text>'),_a=se('<g class="tooltip"><rect x="-60" y="-45" width="120" height="40" rx="4" class="tooltip-bg svelte-1q0dbv2"></rect><text x="0" y="-30" text-anchor="middle" class="tooltip-title svelte-1q0dbv2"> </text><text x="0" y="-14" text-anchor="middle" class="tooltip-label svelte-1q0dbv2"> </text></g>'),wa=se('<g class="hover-cursor"><line class="hover-line svelte-1q0dbv2"></line><text text-anchor="middle" class="hover-date svelte-1q0dbv2"> </text></g>'),ba=q('<div class="chart-container svelte-1q0dbv2"><svg class="line-chart svelte-1q0dbv2"><g class="grid"></g><g class="monday-lines"></g><g><!><!><!><!></g><g class="y-axis"></g><g class="x-axis"></g><!><!></svg> <div class="legend svelte-1q0dbv2"><div class="legend-item svelte-1q0dbv2"><span class="legend-line mood svelte-1q0dbv2"></span> <span>Mood</span></div> <div class="legend-item svelte-1q0dbv2"><span class="legend-line energy svelte-1q0dbv2"></span> <span>Energy</span></div></div></div>'),Ma=q('<div class="mood-energy-chart svelte-1q0dbv2"><h3 class="svelte-1q0dbv2">Mood & Energy Evolution</h3> <!></div>');function Da(de,h){Me(h,!0);const V={1:"Terrible",2:"Very Bad",3:"Bad",4:"Poor",5:"Okay",6:"Good",7:"Great",8:"Very Good",9:"Excellent",10:"Amazing"},j={1:"Exhausted",2:"Very Tired",3:"Tired",4:"Drained",5:"Low",6:"Moderate",7:"Good",8:"Energetic",9:"Vibrant",10:"Peak Energy"};let u=be(600);const le=300,x={top:20,right:20,bottom:40,left:50};let Q=f(()=>Math.max(e(u),450)),te=f(()=>e(Q)-x.left-x.right);const ee=le-x.top-x.bottom;let d=f(()=>[...h.events].filter(t=>t.mood||t.energy).sort((t,r)=>t.eventDateUnix-r.eventDateUnix)),s=f(()=>{const t=e(d).flatMap(r=>[r.mood,r.energy].filter(n=>n!=null));return t.length>0?Math.min(...t):1}),y=f(()=>{const t=e(d).flatMap(r=>[r.mood,r.energy].filter(n=>n!=null));return t.length>0?Math.max(...t):10}),H=f(()=>{if(e(d).length===0)return()=>0;const t=e(d)[0].eventDateUnix,n=e(d)[e(d).length-1].eventDateUnix-t||1;return w=>(w-t)/n*e(te)}),J=f(()=>{const t=e(y)-e(s)||1;return r=>ee-(r-e(s))/t*ee});const M=t=>t.length===0?"":t.map((r,n)=>`${n===0?"M":"L"} ${r.x} ${r.y}`).join(" ");let X=f(()=>e(d).filter(t=>t.mood!==void 0&&t.mood!==null).map(t=>({x:e(H)(t.eventDateUnix),y:e(J)(t.mood),value:t.mood,date:t.eventDateUnix}))),z=f(()=>e(d).filter(t=>t.energy!==void 0&&t.energy!==null).map(t=>({x:e(H)(t.eventDateUnix),y:e(J)(t.energy),value:t.energy,date:t.eventDateUnix}))),k=f(()=>M(e(X))),C=f(()=>M(e(z))),A=f(()=>{const t=[];for(let r=e(s);r<=e(y);r++)t.push(r);return t}),T=f(()=>{if(e(d).length===0)return[];const t=6,r=[];if(e(d).length<=t)for(const n of e(d))r.push({x:e(H)(n.eventDateUnix),label:ce.fromSeconds(n.eventDateUnix).toFormat("dd/MM")});else{const n=[0],w=t-2,B=(e(d).length-1)/(w+1);for(let P=1;P<=w;P++)n.push(Math.round(B*P));n.push(e(d).length-1);for(const P of n){const ae=e(d)[P];r.push({x:e(H)(ae.eventDateUnix),label:ce.fromSeconds(ae.eventDateUnix).toFormat("dd/MM")})}}return r}),Y=f(()=>{if(e(d).length===0)return[];const t=e(d)[0].eventDateUnix,r=e(d)[e(d).length-1].eventDateUnix;let n=ce.fromSeconds(t).startOf("day");const w=(8-n.weekday)%7;n=n.plus({days:w===0&&n.weekday!==1?7:w});const B=[],P=ce.fromSeconds(r);for(;n<=P;){const ae=n.toSeconds();B.push({x:e(H)(ae),label:n.toFormat("dd/MM")}),n=n.plus({weeks:1})}return B});const I=t=>{if(e(d).length===0)return;const n=t.currentTarget.getBoundingClientRect(),B=(t.clientX-n.left)/n.width*e(Q)-x.left;if(B>=0&&B<=e(te)){const P=e(d)[0].eventDateUnix,we=e(d)[e(d).length-1].eventDateUnix-P||1,oe=P+B/e(te)*we;h.onHoverChange(oe)}else h.onHoverChange(null)},U=()=>{h.onHoverChange(null)};let Z=f(()=>{if(h.hoveredTimestamp===null||e(d).length===0)return null;const t=e(d)[0].eventDateUnix,r=e(d)[e(d).length-1].eventDateUnix;return h.hoveredTimestamp<t||h.hoveredTimestamp>r?null:e(H)(h.hoveredTimestamp)}),ne=f(()=>h.hoveredTimestamp!==null?ce.fromSeconds(h.hoveredTimestamp).startOf("day"):null),E=be(null);var ge=Ma(),g=m(v(ge),2);{var a=t=>{var r=da();i(t,r)},o=t=>{var r=ba(),n=v(r);n.__mousemove=I;var w=v(n);ie(w,21,()=>e(A),ve,(L,S)=>{var p=ua();D((he,ye)=>{c(p,"x1",x.left),c(p,"y1",he),c(p,"x2",e(Q)-x.right),c(p,"y2",ye)},[()=>x.top+e(J)(e(S)),()=>x.top+e(J)(e(S))]),i(L,p)}),l(w);var B=m(w);ie(B,21,()=>e(Y),ve,(L,S)=>{var p=ga();D(()=>{c(p,"x1",x.left+e(S).x),c(p,"y1",x.top),c(p,"x2",x.left+e(S).x),c(p,"y2",x.top+ee)}),i(L,p)}),l(B);var P=m(B),ae=v(P);{var we=L=>{var S=ma();D(()=>c(S,"d",e(C))),i(L,S)};G(ae,L=>{e(C)&&L(we)})}var oe=m(ae);{var K=L=>{var S=ha();D(()=>c(S,"d",e(k))),i(L,S)};G(oe,L=>{e(k)&&L(K)})}var b=m(oe);ie(b,17,()=>e(z),ve,(L,S)=>{var p=fa();D(()=>{c(p,"cx",e(S).x),c(p,"cy",e(S).y)}),Se("mouseenter",p,()=>_e(E,{...e(S),type:"energy"},!0)),Se("mouseleave",p,()=>_e(E,null)),i(L,p)});var W=m(b);ie(W,17,()=>e(X),ve,(L,S)=>{var p=xa();D(()=>{c(p,"cx",e(S).x),c(p,"cy",e(S).y)}),Se("mouseenter",p,()=>_e(E,{...e(S),type:"mood"},!0)),Se("mouseleave",p,()=>_e(E,null)),i(L,p)}),l(P);var O=m(P);ie(O,21,()=>e(A),ve,(L,S)=>{var p=ya(),he=v(p,!0);l(p),D(ye=>{c(p,"x",x.left-8),c(p,"y",ye),N(he,e(S))},[()=>x.top+e(J)(e(S))+4]),i(L,p)}),l(O);var $=m(O);ie($,21,()=>e(T),ve,(L,S)=>{var p=pa(),he=v(p,!0);l(p),D(()=>{c(p,"x",x.left+e(S).x),c(p,"y",le-x.bottom+20),N(he,e(S).label)}),i(L,p)}),l($);var re=m($);{var fe=L=>{var S=_a(),p=m(v(S)),he=v(p);l(p);var ye=m(p),Ue=v(ye,!0);l(ye),l(S),D(()=>{c(S,"transform",`translate(${x.left+e(E).x}, ${x.top+e(E).y})`),N(he,`${e(E).type==="mood"?"Mood":"Energy"}: ${e(E).value??""}`),N(Ue,e(E).type==="mood"?V[e(E).value]:j[e(E).value])}),i(L,S)};G(re,L=>{e(E)&&L(fe)})}var ue=m(re);{var me=L=>{var S=wa(),p=v(S),he=m(p),ye=v(he,!0);l(he),l(S),D(Ue=>{c(p,"x1",x.left+e(Z)),c(p,"y1",x.top),c(p,"x2",x.left+e(Z)),c(p,"y2",x.top+ee),c(he,"x",x.left+e(Z)),c(he,"y",x.top-6),N(ye,Ue)},[()=>e(ne).toFormat("dd/MM")]),i(L,S)};G(ue,L=>{e(Z)!==null&&e(ne)&&L(me)})}l(n),Ne(2),l(r),D(()=>{c(n,"viewBox",`0 0 ${e(Q)??""} 300`),c(P,"transform",`translate(${x.left}, ${x.top})`)}),Se("mouseleave",n,U),Re(r,"clientWidth",L=>_e(u,L)),i(t,r)};G(g,t=>{e(d).length===0?t(a):t(o,!1)})}l(ge),i(de,ge),De()}je(["mousemove"]);var ka=q("<p>Loading events</p>"),Ua=q("<!> <!> <!> <!> <!>",1);function $a(de,h){Me(h,!0);const V=()=>Ee(Be,"$personalTrackerPassword",u),j=()=>Ee(Ce,"$eventsStore",u),[u,le]=He();Xe(()=>{Ce.fetch(V())});let x=be(Oe(ce.now().minus({week:1}).toMillis())),Q=be(Oe(ce.now().toMillis())),te=f(()=>j().events.filter(M=>M.eventDateUnix>=e(x)/1e3&&M.eventDateUnix<=e(Q)/1e3).sort((M,X)=>X.eventDateUnix-M.eventDateUnix)),ee=be(null);const d=M=>{_e(ee,M,!0)};var s=ke(),y=xe(s);{var H=M=>{var X=ka();i(M,X)},J=M=>{var X=ke(),z=xe(X);{var k=A=>{{let T=f(()=>({level:"error",header:"Something went wrong getting events",message:j().error.message}));Ae(A,{get item(){return e(T)}})}},C=A=>{var T=Ua(),Y=xe(T);Et(Y,{get startDate(){return e(x)},set startDate(E){_e(x,E,!0)},get endDate(){return e(Q)},set endDate(E){_e(Q,E,!0)}});var I=m(Y,2);Da(I,{get events(){return e(te)},get hoveredTimestamp(){return e(ee)},onHoverChange:d});var U=m(I,2);ca(U,{get events(){return e(te)},get hoveredTimestamp(){return e(ee)},onHoverChange:d});var Z=m(U,2);It(Z,{get events(){return e(te)},get hoveredTimestamp(){return e(ee)},onHoverChange:d});var ne=m(Z,2);Yt(ne,{get events(){return e(te)}}),i(A,T)};G(z,A=>{j().error?A(k):A(C,!1)},!0)}i(M,X)};G(y,M=>{j().loading?M(H):M(J,!1)})}i(de,s),De(),le()}var Sa=q(`<div class="controls svelte-8wagie"><button>Add Today's entry</button> <button class="view-toggle svelte-8wagie"> </button></div> <!>`,1),ja=q("<!> <!>",1);function Ya(de,h){Me(h,!0);const V={name:"Personal Tracker",description:"Track me metrics",iconPath:"/personal_tracker.png",showAuthInHeader:!0};rt.set(V);const j=["calendar","list","metrics"];let u=be("calendar");const le=()=>{const d=j.indexOf(e(u));_e(u,j[(d+1)%j.length],!0)},x={calendar:"üìÖ Calendar",list:"üìã List",metrics:"üìä Metrics"};var Q=ja(),te=xe(Q);et(te,{get title(){return V.name},get description(){return V.description},get iconPath(){return V.iconPath}});var ee=m(te,2);Qe(ee,{message:"Login to see events",requiredScope:"admin",children:(d,s)=>{nt(d,{children:(y,H)=>{var J=Sa(),M=xe(J),X=v(M);X.__click=()=>Ie("/personal-tracker/add");var z=m(X,2);z.__click=le;var k=v(z,!0);l(z),l(M);var C=m(M,2);{var A=Y=>{jt(Y,{})},T=Y=>{var I=ke(),U=xe(I);{var Z=E=>{xt(E,{})},ne=E=>{$a(E,{})};G(U,E=>{e(u)==="list"?E(Z):E(ne,!1)},!0)}i(Y,I)};G(C,Y=>{e(u)==="calendar"?Y(A):Y(T,!1)})}D(Y=>N(k,Y),[()=>x[j[j.indexOf(e(u))]]]),i(y,J)},$$slots:{default:!0}})},$$slots:{default:!0}}),i(de,Q),De()}je(["click"]);export{Ya as component};
