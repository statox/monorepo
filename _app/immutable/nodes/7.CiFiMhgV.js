import"../chunks/DsnmJJEf.js";import{p as A,b as y,a as g,d as F,e as t,s as n,r as o,t as H,g as r,h as _,n as O,i as m,aI as R}from"../chunks/eXUqL77E.js";import{s as Y,e as Z}from"../chunks/BemXrffE.js";import{i as j}from"../chunks/CTMdkGpN.js";import{r as $}from"../chunks/CujdopWx.js";import{b as x}from"../chunks/CEUJmi10.js";import{s as z,a as B}from"../chunks/y59AJ40k.js";import{a as C,g as G}from"../chunks/CugOu0Ig.js";import{a as J,b as K,u as Q}from"../chunks/B0neLVfT.js";import{s as E}from"../chunks/B4-ntoLf.js";import{M as V}from"../chunks/71ylWyng.js";var W=y('<p class="svelte-1my11jv"> </p>'),X=y('<form><div class="input-group svelte-1my11jv"><label for="username" class="svelte-1my11jv">Username:</label> <input id="username" name="username" type="text" autocomplete="username" placeholder="Enter your username" required class="svelte-1my11jv"/></div> <div class="input-group svelte-1my11jv"><label for="current-password" class="svelte-1my11jv">Password:</label> <input id="current-password" name="password" type="password" autocomplete="current-password" placeholder="Enter your password" required class="svelte-1my11jv"/></div> <!> <button type="submit" class="svelte-1my11jv">Sign in</button></form>'),ee=y('<div class="login-container svelte-1my11jv"><div class="login-card svelte-1my11jv"><h2 class="svelte-1my11jv">Login</h2> <!></div></div>');function pe(I,L){A(L,!0);const u=()=>B(J,"$user",P),[P,S]=z();let v=_(""),p=_(""),i=_(void 0),d="/";C(({from:e})=>{e?.url.pathname!=="/auth/login"&&(d=e?.url.pathname||d)});const U=async e=>{e.preventDefault();try{await K(r(v),r(p)),await Q(),u()?.status=="logged_in"?(E.set(!0),setTimeout(()=>E.set(!1),2500),G(d)):m(i,new Error("Invalid password or username"),!0)}catch(s){if(s?.message==='{"message":"UNAUTHORIZED"}'){m(i,"Invalid password or username");return}m(i,s,!0)}};var c=ee(),h=t(c),q=n(t(h),2);{var D=e=>{var s=W(),l=t(s);o(s),H(()=>Y(l,`You are already logged in as ${u()?.user.username??""}`)),g(e,s)},M=e=>{var s=X(),l=t(s),b=n(t(l),2);$(b),o(l);var f=n(l,2),w=n(t(f),2);$(w),o(f);var N=n(f,2);{var T=a=>{{let k=R(()=>({level:"error",header:"Failed auth",message:r(i).toString()}));V(a,{get item(){return r(k)}})}};j(N,a=>{r(i)&&a(T)})}O(2),o(s),Z("submit",s,U),x(b,()=>r(v),a=>m(v,a)),x(w,()=>r(p),a=>m(p,a)),g(e,s)};j(q,e=>{u()?.status=="logged_in"?e(D):e(M,!1)})}o(h),o(c),g(I,c),F(),S()}export{pe as component};
