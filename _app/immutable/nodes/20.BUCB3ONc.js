import"../chunks/DsnmJJEf.js";import{a as pt}from"../chunks/vjUZdrab.js";import{p as lt,b as m,f,s as o,a as s,d as vt,e as N,r as O,g as a,h as b,i as r,c as V,t as Y,j as q}from"../chunks/eXUqL77E.js";import{d as gt,s as z}from"../chunks/BemXrffE.js";import{i as v}from"../chunks/CTMdkGpN.js";import{r as mt}from"../chunks/CujdopWx.js";import{b as _t}from"../chunks/CEUJmi10.js";import{B as R,a as F}from"../chunks/DukMpd72.js";import{g as ct,c as dt}from"../chunks/B0neLVfT.js";import{g as ut}from"../chunks/CugOu0Ig.js";import"../chunks/ctDXYmCv.js";import"../chunks/Dx65nAjy.js";import{p as ft}from"../chunks/B4-ntoLf.js";/* empty css                */import{M as bt}from"../chunks/utk3oDie.js";var wt=m('<button>Start a new game</button> <br/> <input type="string"/> <button>Join Game</button>',1),yt=m("<p>Connecting to the server…</p>"),ht=m("<p>Waiting for an opponent to connect…</p>"),St=m("<p> </p> <!>",1),kt=m("<p>Something went wrong. Board is not defined.</p>"),Pt=m('<p>Game over</p> <button>Restart</button> <span style="font-weight: bold"><!></span> <!>',1),Ct=m("<p>Disconnected</p>"),Gt=m("<!> <h3>Online game <button>Back</button></h3> <!> <!> <!> <!> <!> <!>",1);function Vt(H,K){lt(K,!0);const h={name:"Gravitrips",description:"4 in a row",iconPath:"/gravitrips.png"};ft.set(h);let n,x=b(null),_=b(null),c=b(null),S=b(null),p=b("initial"),k=b("");const Q=async()=>{const t=await dt.gravitrips.getNewGame();if(!t.gameId)throw new Error("Couldn't start the game");r(k,t.gameId,!0),B()},T=ct().replace(/^http?/,"ws");pt(()=>{n&&n.close()});const B=()=>{n=new WebSocket(T+"/gravitrips/ws?"+a(k)),r(p,"connecting"),r(_,null),r(c,null),r(S,null),n.onopen=()=>{r(p,"waiting_for_opponent")},n.onclose=t=>{console.log(t.reason),r(p,"disconnected")},n.onmessage=t=>{const e=JSON.parse(t.data);e.type==="game_ready"?(r(p,"playing"),r(x,e.youAre,!0),r(_,e.board,!0)):e.type==="update_board"?(r(_,e.board,!0),r(c,e.boardState,!0),r(S,e.winningCells,!0)):e.type==="waiting_for_opponent"?r(c,null):e.type==="game_over"&&r(p,"game_over")}},E=t=>{if(!n||n.readyState!==WebSocket.OPEN)return;const e=JSON.stringify({type:"move",column:t});n.send(e)},X=()=>{if(!n||n.readyState!==WebSocket.OPEN)return;const t=JSON.stringify({type:"restart"});n.send(t)};var W=Gt(),I=f(W);bt(I,{get title(){return h.name},get description(){return h.description},get iconPath(){return h.iconPath}});var C=o(I,2),Z=o(N(C));Z.__click=()=>ut("/gravitrips"),O(C);var J=o(C,2);{var $=t=>{var e=wt(),d=f(e);d.__click=Q;var g=o(d,4);mt(g);var w=o(g,2);w.__click=B,_t(g,()=>a(k),l=>r(k,l)),s(t,e)};v(J,t=>{["initial","waiting_for_opponent","game_over","disconnected"].includes(a(p))&&t($)})}var A=o(J,2);{var tt=t=>{var e=yt();s(t,e)};v(A,t=>{a(p)==="connecting"&&t(tt)})}var D=o(A,2);{var et=t=>{var e=ht();s(t,e)};v(D,t=>{a(p)==="waiting_for_opponent"&&t(et)})}var U=o(D,2);{var at=t=>{var e=V(),d=f(e);{var g=l=>{var u=St(),y=f(u),G=N(y);O(y);var i=o(y,2);F(i,{nbColumns:7,nbRows:6,get board(){return a(_)},get winningCells(){return a(S)},onMove:E}),Y(()=>z(G,`You are Player ${a(x)??""}`)),s(l,u)},w=l=>{var u=kt();s(l,u)};v(d,l=>{a(_)!==null?l(g):l(w,!1)})}s(t,e)};v(U,t=>{a(p)==="playing"&&t(at)})}var j=o(U,2);{var rt=t=>{var e=Pt(),d=o(f(e),2);d.__click=X;var g=o(d,2),w=N(g);{var l=i=>{var P=q("Game Over");s(i,P)},u=i=>{var P=V(),it=f(P);{var st=M=>{var L=q();Y(()=>z(L,`Player ${a(c)??""} wins`)),s(M,L)};v(it,M=>{(a(c)===R.winPlayer1||a(c)===R.winPlayer2)&&M(st)},!0)}s(i,P)};v(w,i=>{a(c)===R.draw?i(l):i(u,!1)})}O(g);var y=o(g,2);{var G=i=>{F(i,{nbColumns:7,nbRows:6,get board(){return a(_)},get winningCells(){return a(S)},onMove:E})};v(y,i=>{a(_)!==null&&i(G)})}s(t,e)};v(j,t=>{a(p)==="game_over"&&t(rt)})}var ot=o(j,2);{var nt=t=>{var e=Ct();s(t,e)};v(ot,t=>{a(p)==="disconnected"&&t(nt)})}s(H,W),vt()}gt(["click"]);export{Vt as component};
