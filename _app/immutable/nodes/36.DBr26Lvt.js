import"../chunks/DsnmJJEf.js";import{p as J,c as pe,f as H,a as o,d as R,b as p,e as r,r as a,s as t,g as u,aI as M,t as W,h as fe,F as _e,i as ge}from"../chunks/eXUqL77E.js";import{s as z,d as be}from"../chunks/BemXrffE.js";import{a as we}from"../chunks/DyzBQ-gh.js";import{t as xe,d as De,g as le}from"../chunks/DfQIOrcr.js";import{e as ye,i as ke}from"../chunks/D9zXBg3D.js";import{i as B}from"../chunks/CTMdkGpN.js";import{r as h,e as m,a as Ue}from"../chunks/CujdopWx.js";import{a as Se,s as Me}from"../chunks/y59AJ40k.js";import{M as We}from"../chunks/tLIPpPCu.js";import{t as Ce}from"../chunks/BtWB7XCZ.js";import{M as Le}from"../chunks/KatJBqrF.js";import{M as Ee}from"../chunks/Cjw1GVnL.js";import{a as Ae}from"../chunks/B0neLVfT.js";import{a as Ie}from"../chunks/CkcISRbr.js";import"../chunks/ctDXYmCv.js";import"../chunks/CguJ9Ee1.js";import{p as Pe}from"../chunks/B4-ntoLf.js";/* empty css                */import{M as ne}from"../chunks/CQl9_8lk.js";import{g as Ne}from"../chunks/BJmgLU8A.js";const Te=!1,ut=Object.freeze(Object.defineProperty({__proto__:null,ssr:Te},Symbol.toStringTag,{value:"Module"}));var Fe=p('<p class="section-3-item svelte-1e53865"><label for="css-selector">CSS selector <!></label> <input disabled type="textarea" class="svelte-1e53865"/></p>'),Oe=p('<div class="section error-section svelte-1e53865"><p class="section-4-item svelte-1e53865"><label for="last-check">Last error</label> <input disabled type="textarea" class="svelte-1e53865"/></p> <p class="section-4-item svelte-1e53865"><label for="last-update">Last error message</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div>'),je=p('<div class="item svelte-1e53865"><h3 class="item-title svelte-1e53865"><div class="item-name svelte-1e53865"> </div> <div class="item-actions svelte-1e53865"><!> <!></div></h3> <div class="section svelte-1e53865"><p class="section-1-item svelte-1e53865"><label for="check-interval">Check interval</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div> <div class="section svelte-1e53865"><p class="section-2-item svelte-1e53865"><label for="notification-message">Notification message</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div> <div class="section svelte-1e53865"><p class="section-3-item svelte-1e53865"><label for="content">URL</label> <a target="_blank" rel="noopener noreferrer"> </a></p> <!></div> <div class="section svelte-1e53865"><p class="section-4-item svelte-1e53865"><label for="last-check">Last check</label> <input disabled type="textarea" class="svelte-1e53865"/></p> <p class="section-4-item svelte-1e53865"><label for="last-update">Last content change</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div> <!> <div class="section svelte-1e53865"><p class="section-3-item svelte-1e53865"><label for="last-update">Last content</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div></div>');function qe(x,e){J(e,!0);const w=()=>Se(Ae,"$user",c),[c,i]=Me(),s=n=>{const d=new Date(n*1e3);return d.toLocaleDateString()+" "+d.toLocaleTimeString()},k=M(()=>e.watcher.lastCheckDateUnix===0?"Never checked before":s(e.watcher.lastCheckDateUnix||0)),U=M(()=>e.watcher.lastUpdateDateUnix===0?"Never changed":s(e.watcher.lastUpdateDateUnix||0)),C=M(()=>Ie.fromMillis(e.watcher.checkIntervalSeconds*1e3).rescale().toHuman()),l=async()=>{if(!e.watcher.id){console.error("id must be defined");return}try{await De({id:e.watcher.id}),e.onDelete()}catch(n){const d=`<strong>Watcher not deleted</strong><br/> ${n.message}`;Ce.push(d,{theme:{"--toastBarBackground":"#FF0000"}})}},v=async n=>{await xe({watcherId:e.watcher.id,setToEnabled:n==="on"}),e.onUpdate()};let f=M(()=>e.watcher.archivalDateUnix?"off":"on");var D=pe(),L=H(D);{var E=n=>{var d=je(),A=r(d),I=r(A),oe=r(I,!0);a(I);var V=t(I,2),G=r(V);Ee(G,{get value(){return u(f)},label:"Enabled",onchange:v,design:"slider"});var ce=t(G,2);Le(ce,{deleteAction:l}),a(V),a(A);var P=t(A,2),K=r(P),Q=t(r(K),2);h(Q),a(K),a(P);var N=t(P,2),X=r(N),Y=t(r(X),2);h(Y),a(X),a(N);var T=t(N,2),F=r(T),O=t(r(F),2),ve=r(O,!0);a(O),a(F);var de=t(F,2);{var he=_=>{var g=Fe(),b=r(g),S=t(r(b));We(S,{get content(){return e.watcher.cssSelector}}),a(b);var y=t(b,2);h(y),a(g),W(()=>m(y,e.watcher.cssSelector)),o(_,g)};B(de,_=>{e.watcher.cssSelector&&_(he)})}a(T);var j=t(T,2),q=r(j),Z=t(r(q),2);h(Z),a(q);var $=t(q,2),ee=t(r($),2);h(ee),a($),a(j);var te=t(j,2);{var me=_=>{var g=Oe(),b=r(g),S=t(r(b),2);h(S),a(b);var y=t(b,2),ie=t(r(y),2);h(ie),a(y),a(g),W(ue=>{m(S,ue),m(ie,e.watcher.lastErrorMessage)},[()=>s(e.watcher.lastErrorDateUnix)]),o(_,g)};B(te,_=>{e.watcher.lastErrorDateUnix&&_(me)})}var ae=t(te,2),re=r(ae),se=t(r(re),2);h(se),a(re),a(ae),a(d),W(()=>{z(oe,e.watcher.name),m(Q,u(C)),m(Y,e.watcher.notificationMessage),Ue(O,"href",e.watcher.url),z(ve,e.watcher.url),m(Z,u(k)),m(ee,u(U)),m(se,e.watcher.lastContent)}),o(n,d)};B(L,n=>{w()&&n(E)})}o(x,D),R(),i()}var Be=p('<div class="container svelte-ihkiaa"></div>');function He(x,e){J(e,!0);const w=(i,s)=>i.archivalDateUnix===null&&s.archivalDateUnix!==null?-1:i.archivalDateUnix!==null&&s.archivalDateUnix===null?1:s.id-i.id;var c=Be();ye(c,21,()=>e.watchers.sort(w),ke,(i,s)=>{qe(i,{get watcher(){return u(s)},get onDelete(){return e.onDelete},get onUpdate(){return e.onUpdate}})}),a(c),o(x,c),R()}var ze=p("<button>Add an entry</button>"),Je=p("<p>Something went wrong</p> <p> </p>",1),Re=p("<p>Loading data</p>"),Ve=p("<h2>Create a new watcher</h2> <!> <h2>Watchers</h2> <!>",1);function pt(x,e){J(e,!0),Pe.set({name:"Web Watchers",showAuthInHeader:!0});let w=fe(_e(le()));const c=()=>ge(w,le(),!0);ne(x,{message:"Login to list the watchers",requiredScope:"admin",children:(i,s)=>{var k=Ve(),U=t(H(k),2);ne(U,{message:"Login to add an entry",requiredScope:"admin",children:(l,v)=>{var f=ze();f.__click=()=>Ne("/webwatcher/create"),o(l,f)},$$slots:{default:!0}});var C=t(U,4);we(C,()=>u(w),l=>{var v=Re();o(l,v)},(l,v)=>{He(l,{get watchers(){return u(v)},onDelete:c,onUpdate:c})},(l,v)=>{var f=Je(),D=t(H(f),2),L=r(D,!0);a(D),W(E=>z(L,E),[()=>JSON.stringify(u(v))]),o(l,f)}),o(i,k)},$$slots:{default:!0}}),R()}be(["click"]);export{pt as component,ut as universal};
