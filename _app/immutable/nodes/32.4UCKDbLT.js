import{g as Bt,a as wt,b as Vt,c as Ut}from"../chunks/B8Xx_MxO.js";import"../chunks/DsnmJJEf.js";import{o as gt}from"../chunks/vjUZdrab.js";import{p as z,a1 as kt,g as t,b as S,t as I,a as _,d as G,i as q,h as M,f as O,s as g,e as d,r as l,aI as F,c as X,j as Ct,F as ot}from"../chunks/eXUqL77E.js";import{d as lt,w as yt,s as U,g as Mt}from"../chunks/BemXrffE.js";import{e as j,i as P}from"../chunks/D9zXBg3D.js";import{c as It}from"../chunks/Dj4tCFJc.js";import{s as vt,d as Lt,a as et,b as ft,r as pt}from"../chunks/CujdopWx.js";import{b as Ot,c as Ft}from"../chunks/CEUJmi10.js";import{s as xt,d as St,a as mt}from"../chunks/y59AJ40k.js";import{m as jt}from"../chunks/BuqJaIpI.js";import{a as Dt}from"../chunks/_KUvakVp.js";import{M as Et}from"../chunks/utk3oDie.js";import{M as Rt}from"../chunks/71ylWyng.js";import{i as J}from"../chunks/CTMdkGpN.js";import{k as _t}from"../chunks/5A8KQ7Q_.js";import{p as dt}from"../chunks/TtEguMge.js";import{b as Nt,g as Pt}from"../chunks/DBm6smYt.js";import{t as Ht}from"../chunks/BtWB7XCZ.js";import{d as Jt,k as ht,a as zt}from"../chunks/CnfZ9F3w.js";import{U as Gt}from"../chunks/BWptIUEw.js";import{b as Kt}from"../chunks/fZ77XKzl.js";import{a as Wt}from"../chunks/DyzBQ-gh.js";import"../chunks/ctDXYmCv.js";import"../chunks/DCHNKFqy.js";import{p as Qt}from"../chunks/B4-ntoLf.js";const Xt=!1,Yt=async()=>({chords:await Bt()}),or=Object.freeze(Object.defineProperty({__proto__:null,load:Yt,ssr:Xt},Symbol.toStringTag,{value:"Module"}));var Zt=S('<button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" class="svelte-1vskasp"><path d="M12 6H0l6-6z"></path></svg> <span class="screen-reader-text svelte-1vskasp">Back to top</span></button>');function $t(L,i){z(i,!0);let f=M(0),m=M(!0),y;const D=o=>{o>0?q(m,!1):q(m,!0),y&&clearTimeout(y),y=setTimeout(()=>{q(m,!0)},3e3)},b=()=>{const o=document.documentElement.scrollTop||document.body.scrollTop;o>0&&(window.requestAnimationFrame(b),window.scrollTo(0,o-o/2))};kt(()=>D(t(f)));var r=Zt();let e;r.__click=b,I(()=>e=vt(r,1,"top-link svelte-1vskasp",null,e,{hide:t(m)})),Dt("y",()=>t(f),o=>q(f,o,!0)),_(L,r),G()}lt(["click"]);const nt=yt();let Tt=[];const bt=localStorage.getItem("failedVisitCounts");if(bt!==null)try{Tt=JSON.parse(bt)}catch{console.error("Couldnt parse failedVisitCounts from local storage")}const ut=yt(Tt);ut.subscribe(L=>{localStorage.setItem("failedVisitCounts",JSON.stringify(L))});const qt=L=>L==="doc"?"fas fa-file-word":L==="pdf"?"fas fa-file-pdf":L==="youtube"?"fa fa-youtube":"fas fa-link";var te=S('<span></span> <span><a target="_blank" rel="noopener noreferrer"> </a></span>',1);function it(L,i){z(i,!0);const f=()=>mt(ut,"$failedVisitCounts",m),[m,y]=xt();let D=dt(i,"showArtist",3,!1),b=M(void 0);nt.subscribe(a=>{if(a&&a.has(i.chord.url)){const v=a.get(i.chord.url),s=new Date(v.lastAccessDateUnix*1e3);q(b,`visits: ${v.count} - last: ${s.toLocaleDateString()}`)}});const r=F(()=>(D()?i.chord.artist+" - ":"")+i.chord.title),e=a=>a.type==="doc"?`${Nt}/docviewer/${a.url}`:a.url,o=async()=>{try{await wt({url:i.chord.url});const a=Mt(nt),v=a.get(i.chord.url)||{count:0,lastAccessDateUnix:0};v.count++,v.lastAccessDateUnix=Date.now()/1e3,a.set(i.chord.url,v),nt.set(a)}catch(a){let v=a.message;a instanceof Jt&&a.code===401?v="Invalid logged in user":a instanceof Gt&&(v="User is logged out"),St(ut,[...f(),i.chord.url]);const s=`<strong>Visit not counted</strong><br/> ${v}`;Ht.push(s,{initial:1,duration:5e3,theme:{"--toastBarBackground":"#FF0000"}})}};var u=te(),h=O(u),x=g(h,2),p=d(x);p.__click=o;var n=d(p,!0);l(p),l(x),I((a,v)=>{vt(h,1,a,"svelte-et925i"),et(p,"href",v),et(p,"title",t(b)),U(n,t(r))},[()=>Lt(qt(i.chord.type)),()=>e(i.chord)]),_(L,u),G(),y()}lt(["click"]);var ee=S('<li class="ul2col-item"><!> <!></li>'),re=S('<ul class="ul2col-container"></ul>');function ae(L,i){z(i,!0);let f=dt(i,"chords",15),m=M(void 0);nt.subscribe(r=>{r&&(q(m,r,!0),f(f().sort((e,o)=>{const u=r.get(e.url),h=r.get(o.url);return u&&h?h.lastAccessDateUnix-u.lastAccessDateUnix:u?-1:h?1:e.artist!=o.artist?e.artist.toLowerCase()<o.artist.toLowerCase()?-1:1:e.title.toLowerCase()<o.title.toLowerCase()?-1:1})))});const y=(r,e,o)=>o[r.type]===!1?!1:e.length===0||r.artist.toLowerCase().match(e.toLowerCase())?!0:r.title.toLowerCase().match(e.toLowerCase());var D=X(),b=O(D);_t(b,f,r=>{var e=re();j(e,21,f,P,(o,u)=>{const h=F(()=>t(m)?.get(t(u).url));var x=X(),p=O(x);{var n=a=>{var v=ee(),s=d(v);{var c=k=>{var C=Ct();I(()=>U(C,`(${t(h).count??""})`)),_(k,C)};J(s,k=>{t(h)&&k(c)})}var w=g(s,2);it(w,{get chord(){return t(u)},showArtist:!0}),l(v),_(a,v)};J(p,a=>{y(t(u),i.searchString,i.filters)&&a(n)})}_(o,x)}),l(e),_(r,e)}),_(L,D),G()}var se=S('<li class="navigationBtn svelte-16xotip"><a class="navigationLink svelte-16xotip"> </a></li>'),oe=S('<li class="ul2col-item"><!></li>'),ne=S('<ul class="ul2col-container"></ul>'),le=S('<tr class="svelte-16xotip"><td class="svelte-16xotip"> <!></td></tr>'),ie=S('<ol id="indexList" class="navigationBar disable-scrollbars svelte-16xotip"></ol> <table id="artistTable"><tbody></tbody></table>',1);function ce(L,i){z(i,!0);let f=dt(i,"searchString",3,"");const m=F(()=>i.chords.reduce((s,c)=>{const w=c.artist;return s[w]||(s[w]=[]),s[w].push(c),s},{})),y=F(()=>Object.keys(t(m)).sort(ht).map((s,c,w)=>{if(c===0||s[0].toLowerCase()!=w[c-1][0].toLowerCase()){const k="anchor_letter_"+s[0];return{letter:s[0],tag:k}}}).filter(s=>s!==void 0)),D=F(()=>Object.keys(t(m)).sort(ht).map((s,c,w)=>{if(c===0||s[0].toLowerCase()!=w[c-1][0].toLowerCase()){const k="anchor_letter_"+s[0];return{name:s,tag:k}}return{name:s}}));let b=M(0),r=M(0),e=M(void 0);const o=s=>{if(t(e)){var c=t(e).getBoundingClientRect();if(c.top<20){q(r,20);return}q(r,c.top,!0)}};kt(()=>o(t(b)));const u=(s,c,w)=>t(m)[s].sort((C,A)=>C.title<A.title?-1:1).filter(C=>{const A=C.type;return w[A]===!1?!1:c.length===0?!0:!!C.title.toLowerCase().match(c.toLowerCase())}),h=(s,c)=>!!s.toLowerCase().match(c.toLowerCase());var x=ie(),p=O(x);let n;j(p,21,()=>t(y),P,(s,c)=>{var w=se(),k=d(w),C=d(k,!0);l(k),l(w),I(A=>{et(k,"href","#"+t(c).tag),U(C,A)},[()=>t(c).letter.toUpperCase()]),_(s,w)}),l(p);var a=g(p,2),v=d(a);j(v,21,()=>t(D),P,(s,c)=>{const w=F(()=>u(t(c).name,f(),i.filters)),k=F(()=>h(t(c).name,f()));var C=X(),A=O(C);{var E=K=>{const rt=F(()=>t(k)?t(m)[t(c).name]:t(w));var Y=le(),W=d(Y),Z=d(W),$=g(Z);_t($,f,R=>{var H=ne();j(H,21,()=>t(rt),P,(tt,at)=>{var Q=oe(),B=d(Q);it(B,{get chord(){return t(at)}}),l(Q),_(tt,Q)}),l(H),_(R,H)}),l(W),l(Y),I(()=>{et(W,"id",t(c).tag),U(Z,`${t(c).name??""} `)}),_(K,Y)};J(A,K=>{(t(k)||t(w).length>0)&&K(E)})}_(s,C)}),l(v),l(a),Kt(a,s=>q(e,s),()=>t(e)),I(()=>n=ft(p,"",n,{"--barTop":`${t(r)??""}px`})),Dt("y",()=>t(b),s=>q(b,s,!0)),_(L,x),G()}var ue=S('<li class="ul2col-item"><!></li>'),ve=S('<div><span> </span> <ul class="ul2col-container"></ul></div>');function de(L,i){z(i,!0);const f=b=>b.charAt(0).toUpperCase()+b.slice(1).toLowerCase(),m=F(()=>{const b={};for(const r of i.chords)r.tags.forEach(o=>{b[o]||(b[o]=[]),b[o].push(r)});return Object.keys(b).forEach(r=>{b[r].sort((e,o)=>{const u=e.artist.toLowerCase(),h=o.artist.toLowerCase(),x=e.title.toLowerCase(),p=o.title.toLowerCase();return u<h?-1:u>h?1:x<p?-1:1})}),b});var y=X(),D=O(y);j(D,17,()=>Object.keys(t(m)).sort(ht),P,(b,r)=>{var e=X(),o=O(e);{var u=h=>{var x=ve(),p=d(x),n=d(p,!0);l(p);var a=g(p,2);j(a,21,()=>t(m)[t(r)],P,(v,s)=>{var c=X(),w=O(c);{var k=C=>{var A=ue(),E=d(A);it(E,{get chord(){return t(s)},showArtist:!0}),l(A),_(C,A)};J(w,C=>{i.filters[t(s).type]&&C(k)})}_(v,c)}),l(a),l(x),I(v=>U(n,v),[()=>f(t(r))]),_(h,x)};J(o,h=>{(i.searchString.length===0||t(r).toLowerCase().match(i.searchString.toLowerCase()))&&h(u)})}_(b,e)}),_(L,y),G()}var fe=S('<li class="ul2col-item"><!> <!></li>'),me=S('<ul class="ul2col-container"></ul>');function he(L,i){z(i,!0);let f=dt(i,"chords",15),m=M(void 0);nt.subscribe(r=>{r&&(q(m,r,!0),f(f().sort((e,o)=>{const u=r.get(e.url),h=r.get(o.url);return u&&h?u.count!==h.count?h.count-u.count:h.lastAccessDateUnix-u.lastAccessDateUnix:u?-1:h?1:e.artist!=o.artist?e.artist.toLowerCase()<o.artist.toLowerCase()?-1:1:e.title.toLowerCase()<o.title.toLowerCase()?-1:1})))});const y=(r,e,o)=>o[r.type]===!1?!1:e.length===0||r.artist.toLowerCase().match(e.toLowerCase())?!0:r.title.toLowerCase().match(e.toLowerCase());var D=X(),b=O(D);_t(b,f,r=>{var e=me();j(e,21,f,P,(o,u)=>{const h=F(()=>t(m)?.get(t(u).url));var x=X(),p=O(x);{var n=a=>{var v=fe(),s=d(v);{var c=k=>{var C=Ct();I(()=>U(C,`(${t(h).count??""})`)),_(k,C)};J(s,k=>{t(h)&&k(c)})}var w=g(s,2);it(w,{get chord(){return t(u)},showArtist:!0}),l(v),_(a,v)};J(p,a=>{y(t(u),i.searchString,i.filters)&&a(n)})}_(o,x)}),l(e),_(r,e)}),_(L,D),G()}var ge=S('<span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"><a target="_blank" rel="noopener noreferrer"> </a></span> <span class="col svelte-161wm6q"> </span>',1),_e=S('<div class="rows svelte-161wm6q"><span class="col table-head svelte-161wm6q">Last Check</span> <span class="col table-head svelte-161wm6q">Checks</span> <span class="col table-head svelte-161wm6q">Skipped</span> <span class="col table-head svelte-161wm6q">Errors</span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span></div> <br/> <div class="rows svelte-161wm6q"><span class="col table-head svelte-161wm6q">Status</span> <span class="col table-head svelte-161wm6q">Ref</span> <span class="col table-head svelte-161wm6q">Host</span> <span class="col table-head svelte-161wm6q">Data</span> <!></div>',1),pe=S('<p style="color: red"> </p>'),be=S("<p>Fetching results...</p>"),we=S('<div role="dialog" class="modal svelte-161wm6q"><div class="contents svelte-161wm6q"><h3 class="title-bar svelte-161wm6q">Urls checks <button>Close</button></h3> <!></div></div>');function ke(L,i){z(i,!0);const f=r=>{const e=new Date(r.timestamp);return e.toDateString()+" "+e.toTimeString()},m=r=>r.fails.sort((e,o)=>e.chord.url<o.chord.url?-1:1);var y=X(),D=O(y);{var b=r=>{var e=we(),o=d(e),u=d(o),h=g(d(u));h.__click=function(...p){i.close?.apply(this,p)},l(u);var x=g(u,2);Wt(x,Vt,p=>{var n=be();_(p,n)},(p,n)=>{const a=F(()=>f(t(n))),v=F(()=>m(t(n)));var s=_e(),c=O(s),w=g(d(c),8),k=d(w,!0);l(w);var C=g(w,2),A=d(C,!0);l(C);var E=g(C,2),K=d(E,!0);l(E);var rt=g(E,2),Y=d(rt,!0);l(rt),l(c);var W=g(c,4),Z=g(d(W),8);j(Z,17,()=>t(v),P,($,R)=>{var H=ge(),tt=O(H),at=d(tt,!0);l(tt);var Q=g(tt,2),B=d(Q);l(Q);var T=g(Q,2),V=d(T),N=d(V,!0);l(V),l(T);var st=g(T,2),ct=d(st,!0);l(st),I(At=>{U(at,t(R).status),U(B,`${t(R).chord.artist??""} - ${t(R).chord.title??""}`),et(V,"href",t(R).chord.url),U(N,new URL(t(R).chord.url).hostname),U(ct,At)},[()=>t(R).error?JSON.stringify(t(R).error):""]),_($,H)}),l(W),I(()=>{U(k,t(a)),U(A,t(n).nbChecks),U(K,t(n).nbSkipped),U(Y,t(n).nbFails)}),_(p,s)},(p,n)=>{var a=pe(),v=d(a);l(a),I(()=>U(v,`Could not retrieve checks: ${t(n).message??""}`)),_(p,a)}),l(o),l(e),_(r,e)};J(D,r=>{i.isOpen&&r(b)})}_(L,y),G()}lt(["click"]);var Ce=S('<li class="ul2col-separator"> </li>'),ye=S('<!> <li class="ul2col-item"><!></li>',1),Le=S('<div><h3>Latest additions <button class="pull-right">More...</button></h3> <ul class="ul2col-container"></ul></div>');function xe(L,i){z(i,!0);const f=Date.now(),m=1e3*3600*24*7,y=m*4,D=[{label:"last week",time:f-m},{label:"one month ago",time:f-y},{label:"two months ago",time:f-2*y},{label:"six months ago",time:f-6*y},{label:"one year ago",time:f-12*y}],b=F(()=>i.chords.filter(n=>n.creationDate).sort((n,a)=>a.creationDate-n.creationDate).map((n,a,v)=>{const s={...n};if(a>0){const c=v[a-1];for(const{time:w,label:k}of D)c.creationDate>w&&n.creationDate<w&&(s.dateTag=k)}return s}));let r=6,e=M(ot([]));const o=()=>{r+=4,q(e,t(b).slice(0,r),!0)};gt(()=>{o()});var u=Le(),h=d(u),x=g(d(h));x.__click=()=>o(),l(h);var p=g(h,2);j(p,21,()=>t(e),P,(n,a)=>{var v=ye(),s=O(v);{var c=C=>{var A=Ce(),E=d(A,!0);l(A),I(()=>U(E,t(a).dateTag)),_(C,A)};J(s,C=>{t(a).dateTag&&C(c)})}var w=g(s,2),k=d(w);it(k,{get chord(){return t(a)}}),l(w),_(n,v)}),l(p),l(u),_(L,u),G()}lt(["click"]);var Se=S("<button>&nbspâ†¶&nbsp</button>"),De=S('<li class="ul2col-item"><!></li>'),Te=S('<div><h3>Random song <span class="pull-right"><!> <button>Get more random songs</button></span></h3> <br/> <ul class="ul2col-container"></ul></div>');function qe(L,i){z(i,!0);const f=6;let m=M(ot([])),y=M(ot([]));const D=()=>{t(m).length>=i.chords.length-f&&q(m,[],!0);for(let n=0;n<f;n++){let a=-1;for(;a===-1||t(m).includes(a);)a=Math.floor(Math.random()*i.chords.length);t(m).push(a)}q(y,t(m).slice(t(m).length-f).map(n=>i.chords[n]),!0)},b=()=>{t(m).length<=f||(t(m).splice(t(m).length-f),q(y,t(m).slice(t(m).length-f).map(n=>i.chords[n]),!0))};gt(()=>{D()});var r=Te(),e=d(r),o=g(d(e)),u=d(o);{var h=n=>{var a=Se();a.__click=b,_(n,a)};J(u,n=>{t(m).length>f&&n(h)})}var x=g(u,2);x.__click=D,l(o),l(e);var p=g(e,4);j(p,21,()=>t(y),n=>n.url,(n,a)=>{var v=De(),s=d(v);it(s,{get chord(){return t(a)},showArtist:!0}),l(v),_(n,v)}),l(p),l(r),_(L,r),G()}lt(["click"]);var Ae=S('<button class="filter-control svelte-1k2cvi7"><input type="checkbox"/> <span></span></button>'),Be=S("<button> </button>"),Ve=S('<!> <h2><span class="pull-right"><button>Check dead links</button> <button>Edit</button></span></h2> <!> <!> <p> </p> <!> <!> <div><h3>All songs</h3> Search an artist, a title or a tag:<input type="text"/> <button aria-label="delete search"><i class="fas fa-times-circle"></i></button> <div class="filter-controls-container svelte-1k2cvi7"><h4>Filters</h4> <!></div> <h4>View</h4> <div class="view-controls-container svelte-1k2cvi7"></div></div> <!>',1);function nr(L,i){z(i,!0);const f=()=>mt(ut,"$failedVisitCounts",y),m=()=>mt(zt,"$user",y),[y,D]=xt(),b={name:"Songbook",description:"My song book",iconPath:"/songbook.png",showAuthInHeader:!0};Qt.set(b);const r=F(()=>i.data.chords);let e=M(ot([]));const o=B=>{t(e).push(B),q(e,t(e),!0),setTimeout(()=>{t(e).shift(),q(e,t(e),!0)},5e3)};gt(async()=>{try{if(f().length&&m()){o({level:"info",header:"Trying to count missed visits while logged out"});for(const B of f())await wt({url:B});o({level:"success",header:`Counted ${f().length} missed visits`}),St(ut,[])}}catch{o({level:"error",header:"Couldnt upload failed visit counts"})}try{const T=(await Ut()).reduce((V,N)=>(V.set(N.url,{...N}),V),new Map);nt.set(T)}catch{o({level:"error",header:"Couldnt upload failed visit counts"})}});let u=M("");const h=[{label:"By artist",component:ce},{label:"By tags",component:de},{label:"By frequency",component:he},{label:"By access date",component:ae}];let x=M(ot(h[0]));const p={pdf:!0,doc:!0,youtube:!0,link:!0};let n=M(ot({...p}));const a=Object.keys(p);var v=Ve(),s=O(v);Et(s,{get title(){return b.name},get description(){return b.description},get iconPath(){return b.iconPath}});var c=g(s,2),w=d(c),k=d(w);k.__click=()=>jt.open(ke),ft(k,"",{},{position:"relative"});var C=g(k,2);C.__click=()=>Pt("/songbook/edit"),ft(C,"",{},{position:"relative"}),l(w),l(c);var A=g(c,2);j(A,17,()=>t(e),P,(B,T)=>{Rt(B,{get item(){return t(T)}})});var E=g(A,2);$t(E,{});var K=g(E,2),rt=d(K);l(K);var Y=g(K,2);xe(Y,{get chords(){return t(r)}});var W=g(Y,2);qe(W,{get chords(){return t(r)}});var Z=g(W,2),$=g(d(Z),2);pt($);var R=g($,2);R.__click=()=>q(u,"");var H=g(R,2),tt=g(d(H),2);j(tt,17,()=>a,P,(B,T)=>{var V=Ae();V.__click=()=>{t(n)[t(T)]=!t(n)[t(T)],q(n,t(n),!0)};var N=d(V);pt(N);var st=g(N,2);l(V),I(ct=>{et(V,"aria-label",`filter for ${t(T)??""}`),et(N,"id",t(T)),vt(st,1,ct,"svelte-1k2cvi7")},[()=>Lt(qt(t(T)))]),Ft(N,()=>t(n)[t(T)],ct=>t(n)[t(T)]=ct),_(B,V)}),l(H);var at=g(H,4);j(at,21,()=>h,P,(B,T)=>{var V=Be();let N;V.__click=()=>q(x,t(T),!0);var st=d(V,!0);l(V),I(()=>{N=vt(V,1,"control svelte-1k2cvi7",null,N,{selected:t(x)===t(T)}),U(st,t(T).label)}),_(B,V)}),l(at),l(Z);var Q=g(Z,2);It(Q,()=>t(x).component,(B,T)=>{T(B,{get chords(){return t(r)},get searchString(){return t(u)},get filters(){return t(n)}})}),I(()=>U(rt,`This is a list of ${t(r).length??""} song chords I have been gathering since I started teaching myself
    the guitar as a teen and that I like to play.`)),Ot($,()=>t(u),B=>q(u,B)),_(L,v),G(),D()}lt(["click"]);export{nr as component,or as universal};
